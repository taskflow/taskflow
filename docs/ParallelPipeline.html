<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Taskflow Algorithms &raquo; Parallel Pipeline | Taskflow QuickStart</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <span id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">
        <a href="https://taskflow.github.io"><img src="taskflow_logo.png" alt="" />Taskflow</a> <span class="m-breadcrumb">|</span> <a href="index.html" class="m-thin">QuickStart</a>
      </span>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Handbook</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="Algorithms.html">Taskflow Algorithms</a> &raquo;</span>
          Parallel Pipeline
        </h1>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#IncludeHeaderFile">Include the Header</a></li>
            <li><a href="#UnderstandPipelineScheduling">Understand the Pipeline Scheduling Framework</a></li>
            <li><a href="#CreatePipeline">Create a Pipeline Module Task</a></li>
            <li>
              <a href="#ConnectWithTasks">Connect Pipeline with Other Tasks</a>
              <ul>
                <li><a href="#IterateAPipeline">Example 1: Iterate a Pipeline</a></li>
                <li><a href="#ConcatenateTwoPipelines">Example 2: Concatenate Two Pipelines</a></li>
                <li><a href="#DefineMultipleParallelPipelines">Example 3: Define Multiple Parallel Pipelines</a></li>
              </ul>
            </li>
            <li><a href="#ResetPipeline">Reset a Pipeline</a></li>
          </ul>
        </div>
<p>Pipeline parallelism refers to a parallel execution where multiple data elements are processed through a linear chain of stages. Each stage processes the data element sent from the previous stage, applies the given callable to that data element, and then sends the result to the next stage. Multiple data elements can be processed simultaneously across different stages.</p><section id="IncludeHeaderFile"><h2><a href="#IncludeHeaderFile">Include the Header</a></h2><p>You need to include the header file, <code>taskflow/algorithm/pipeline.hpp</code>, for creating a pipeline scheduling framework.</p><pre class="m-code"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;taskflow/algorithm/pipeline.hpp&gt;</span><span class="cp"></span></pre></section><section id="UnderstandPipelineScheduling"><h2><a href="#UnderstandPipelineScheduling">Understand the Pipeline Scheduling Framework</a></h2><p>A <a href="classtf_1_1Pipeline.html" class="m-doc">tf::<wbr />Pipeline</a> object is a composable graph object for users to create a <em>pipeline scheduling framework</em> using a module task in a taskflow. Unlike the conventional pipeline programming frameworks (e.g., Intel TBB), Taskflow&#x27;s pipeline algorithm does not provide any data abstraction, which often restricts users from optimizing data layouts in their applications, but a flexible framework for users to customize their application data atop our pipeline scheduling framework.</p><div class="m-graph"><svg style="width: 22.250rem; height: 22.688rem;" viewBox="0.00 0.00 356.00 363.08">
<g transform="scale(1 1) rotate(0) translate(4 359.0782)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster0</title>
<polygon stroke-dasharray="5,2" points="8,-268.3087 8,-347.0782 340,-347.0782 340,-268.3087 8,-268.3087"/>
<text text-anchor="middle" x="174" y="-330.2782">line 0</text>
</g>
<g class="m-cluster">
<title>cluster1</title>
<polygon stroke-dasharray="5,2" points="8,-181.5391 8,-260.3087 340,-260.3087 340,-181.5391 8,-181.5391"/>
<text text-anchor="middle" x="174" y="-243.5087">line 1</text>
</g>
<g class="m-cluster">
<title>cluster2</title>
<polygon stroke-dasharray="5,2" points="8,-94.7696 8,-173.5391 340,-173.5391 340,-94.7696 8,-94.7696"/>
<text text-anchor="middle" x="174" y="-156.7391">line 2</text>
</g>
<g class="m-cluster">
<title>cluster3</title>
<polygon stroke-dasharray="5,2" points="8,-8 8,-86.7696 340,-86.7696 340,-8 8,-8"/>
<text text-anchor="middle" x="174" y="-69.9696">line 3</text>
</g>
<g class="m-node m-flat">
<title>p00</title>
<ellipse cx="63" cy="-294.6934" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="63" y="-290.8934">pipe&#45;0</text>
</g>
<g class="m-node m-flat">
<title>p10</title>
<ellipse cx="63" cy="-207.9239" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="63" y="-204.1239">pipe&#45;0</text>
</g>
<g class="m-edge">
<title>p00&#45;&gt;p10</title>
<path d="M63,-276.2918C63,-264.8656 63,-249.9322 63,-236.9378"/>
<polygon points="66.5001,-236.598 63,-226.5981 59.5001,-236.5981 66.5001,-236.598"/>
</g>
<g class="m-node m-flat">
<title>p01</title>
<ellipse cx="174" cy="-294.6934" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="174" y="-290.8934">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p00&#45;&gt;p01</title>
<path d="M109.8281,-294.6934C112.1703,-294.6934 114.5125,-294.6934 116.8548,-294.6934"/>
<polygon points="117.1245,-298.1935 127.1245,-294.6934 117.1244,-291.1935 117.1245,-298.1935"/>
</g>
<g class="m-node m-flat">
<title>p20</title>
<ellipse cx="63" cy="-121.1543" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="63" y="-117.3543">pipe&#45;0</text>
</g>
<g class="m-edge">
<title>p10&#45;&gt;p20</title>
<path d="M63,-189.5223C63,-178.096 63,-163.1626 63,-150.1682"/>
<polygon points="66.5001,-149.8285 63,-139.8285 59.5001,-149.8286 66.5001,-149.8285"/>
</g>
<g class="m-node m-flat">
<title>p11</title>
<ellipse cx="174" cy="-207.9239" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="174" y="-204.1239">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p10&#45;&gt;p11</title>
<path d="M109.8281,-207.9239C112.1703,-207.9239 114.5125,-207.9239 116.8548,-207.9239"/>
<polygon points="117.1245,-211.424 127.1245,-207.9239 117.1244,-204.424 117.1245,-211.424"/>
</g>
<g class="m-node m-flat">
<title>p30</title>
<ellipse cx="63" cy="-34.3848" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="63" y="-30.5848">pipe&#45;0</text>
</g>
<g class="m-edge">
<title>p20&#45;&gt;p30</title>
<path d="M63,-102.7527C63,-91.3265 63,-76.3931 63,-63.3987"/>
<polygon points="66.5001,-63.0589 63,-53.059 59.5001,-63.059 66.5001,-63.0589"/>
</g>
<g class="m-node m-flat">
<title>p21</title>
<ellipse cx="174" cy="-121.1543" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="174" y="-117.3543">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p20&#45;&gt;p21</title>
<path d="M109.8281,-121.1543C112.1703,-121.1543 114.5125,-121.1543 116.8548,-121.1543"/>
<polygon points="117.1245,-124.6544 127.1245,-121.1543 117.1244,-117.6544 117.1245,-124.6544"/>
</g>
<g class="m-node m-flat">
<title>p31</title>
<ellipse cx="174" cy="-34.3848" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="174" y="-30.5848">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p30&#45;&gt;p31</title>
<path d="M109.8281,-34.3848C112.1703,-34.3848 114.5125,-34.3848 116.8548,-34.3848"/>
<polygon points="117.1245,-37.8849 127.1245,-34.3848 117.1244,-30.8849 117.1245,-37.8849"/>
</g>
<g class="m-node m-flat">
<title>p02</title>
<ellipse cx="285" cy="-294.6934" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="285" y="-290.8934">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p01&#45;&gt;p02</title>
<path d="M220.8281,-294.6934C223.1703,-294.6934 225.5125,-294.6934 227.8548,-294.6934"/>
<polygon points="228.1245,-298.1935 238.1245,-294.6934 228.1244,-291.1935 228.1245,-298.1935"/>
</g>
<g class="m-node m-flat">
<title>p12</title>
<ellipse cx="285" cy="-207.9239" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="285" y="-204.1239">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p11&#45;&gt;p12</title>
<path d="M220.8281,-207.9239C223.1703,-207.9239 225.5125,-207.9239 227.8548,-207.9239"/>
<polygon points="228.1245,-211.424 238.1245,-207.9239 228.1244,-204.424 228.1245,-211.424"/>
</g>
<g class="m-node m-flat">
<title>p22</title>
<ellipse cx="285" cy="-121.1543" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="285" y="-117.3543">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p21&#45;&gt;p22</title>
<path d="M220.8281,-121.1543C223.1703,-121.1543 225.5125,-121.1543 227.8548,-121.1543"/>
<polygon points="228.1245,-124.6544 238.1245,-121.1543 228.1244,-117.6544 228.1245,-124.6544"/>
</g>
<g class="m-node m-flat">
<title>p32</title>
<ellipse cx="285" cy="-34.3848" rx="46.8387" ry="18.2703"/>
<text text-anchor="middle" x="285" y="-30.5848">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p31&#45;&gt;p32</title>
<path d="M220.8281,-34.3848C223.1703,-34.3848 225.5125,-34.3848 227.8548,-34.3848"/>
<polygon points="228.1245,-37.8849 238.1245,-34.3848 228.1244,-30.8849 228.1245,-37.8849"/>
</g>
<g class="m-edge">
<title>p02&#45;&gt;p12</title>
<path d="M285,-276.2918C285,-264.8656 285,-249.9322 285,-236.9378"/>
<polygon points="288.5001,-236.598 285,-226.5981 281.5001,-236.5981 288.5001,-236.598"/>
</g>
<g class="m-edge">
<title>p12&#45;&gt;p22</title>
<path d="M285,-189.5223C285,-178.096 285,-163.1626 285,-150.1682"/>
<polygon points="288.5001,-149.8285 285,-139.8285 281.5001,-149.8286 288.5001,-149.8285"/>
</g>
<g class="m-edge">
<title>p22&#45;&gt;p32</title>
<path d="M285,-102.7527C285,-91.3265 285,-76.3931 285,-63.3987"/>
<polygon points="288.5001,-63.0589 285,-53.059 281.5001,-63.059 288.5001,-63.0589"/>
</g>
</g>
</svg>
</div><p>The figure above gives an example of our pipeline scheduling framework that consists of three pipes (same concept as stages) and four lines (maximum data concurrency). A pipeline of three pipes and four lines will propagate each data element through a sequential chain of three pipes in the specified order and can simultaneously process up to four data elements at four lines. Each edge represents a task dependency. For example, the edge from <code>pipe-0</code> to <code>pipe-1</code> in line <code>0</code> represents the task dependency between the first and the second pipes in the first line; the edge from <code>pipe-0</code> in line <code>0</code> to <code>pipe-0</code> in line <code>1</code> represents the task dependency between two adjacent lines when processing two tokens at the same pipe. Each pipe can be either a <em>serial</em> (<a href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0" class="m-doc">tf::<wbr />PipeType::<wbr />SERIAL</a>) or a <em>parallel</em> type (<a href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564adf13a99b035d6f0bce4f44ab18eec8eb" class="m-doc">tf::<wbr />PipeType::<wbr />PARALLEL</a>). A serial pipe must process different input tokens in a sequential order. A parallel pipe can process different input tokens simultaneously. The example here represents a serial-parallel-serial pipeline. Since the second pipe is a parallel type, there are no vertical task dependencies between adjacent lines.</p><aside class="m-note m-info"><h4>Note</h4><p>Due to the nature of pipeline, Taskflow requires the first pipe to be a serial type.</p></aside></section><section id="CreatePipeline"><h2><a href="#CreatePipeline">Create a Pipeline Module Task</a></h2><p>In general, there are three steps to create a pipeline application:</p><ol><li>define the pipeline structure (e.g., pipe type, pipe callable, stopping rule, line count)</li><li>define the data storage and layout for the application</li><li>define the pipeline taskflow graph using composition</li></ol><p>The following code creates a pipeline scheduling framework for the example in the previous section. The framework schedules a total of five <em>scheduling tokens</em> labeled from 0 to 4. The first pipe stores the token identifier to a custom buffer storage, and each of the rest pipes adds one to the input data from the previous pipe and stores the result into the corresponding entry in the buffer storage.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_pipes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom dataflow storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_pipes</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline consists of three pipes (serial-parallel-serial)</span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">13</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 5 scheduling tokens</span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">16</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">20</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipe 1: input mybuffer[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">29</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">32</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipe 2: input mybuffer[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">38</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">41</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"></span>
<span class="mi">44</span><span class="o">:</span><span class="w"> </span><span class="c1">// build the pipeline graph using composition</span>
<span class="mi">45</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl</span><span class="p">).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">46</span><span class="o">:</span><span class="w"></span>
<span class="mi">47</span><span class="o">:</span><span class="w"> </span><span class="c1">// execute the taskflow</span>
<span class="mi">48</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>Debrief:</p><ul><li>Lines 4-5 define the structure of the pipeline scheduling framework</li><li>Line 8 defines the data storage as a two-dimensional array (<code>num_lines</code> by <code>num_pipes</code>)</li><li>Line 12 defines the number of lines in the pipeline</li><li>Lines 13-23 define the first serial pipe, which will stop the pipeline scheduling at the fifth token</li><li>Lines 25-32 define the second parallel pipe</li><li>Lines 34-41 define the third serial pipe</li><li>Line 45 defines the pipeline taskflow graph using composition</li><li>Line 48 executes the taskflow</li></ul><p>The data storage, <code>mybuffer</code>, is a four-by-three array. The first dimension is identical to the number of lines and the second dimension is identical to the number of pipes. Each element in <code>mybuffer</code> stores the data associated with the corresponding pipe in a line. For example, <code>mybuffer[1][2]</code> stores the data processed in <code>pipe-2</code> in line <code>1</code>. The following figure shows the data layout of <code>mybuffer</code>.</p><div class="m-graph"><svg style="width: 25.062rem; height: 7.062rem;" viewBox="0.00 0.00 401.00 113.00">
<g transform="scale(1 1) rotate(0) translate(4 109)">
<title>structs</title>
<g class="m-node m-flat">
<title>struct1</title>
<polygon points="0,-.5 0,-104.5 393,-104.5 393,-.5 0,-.5"/>
<text text-anchor="middle" x="65.5" y="-87.7">mybuffer[0][0]</text>
<polyline points="131,-78.5 131,-104.5 "/>
<text text-anchor="middle" x="196.5" y="-87.7">mybuffer[0][1]</text>
<polyline points="262,-78.5 262,-104.5 "/>
<text text-anchor="middle" x="327.5" y="-87.7">mybuffer[0][2]</text>
<polyline points="0,-78.5 393,-78.5 "/>
<text text-anchor="middle" x="65.5" y="-61.7">mybuffer[1][0]</text>
<polyline points="131,-52.5 131,-78.5 "/>
<text text-anchor="middle" x="196.5" y="-61.7">mybuffer[1][1]</text>
<polyline points="262,-52.5 262,-78.5 "/>
<text text-anchor="middle" x="327.5" y="-61.7">mybuffer[1][2]</text>
<polyline points="0,-52.5 393,-52.5 "/>
<text text-anchor="middle" x="65.5" y="-35.7">mybuffer[2][0]</text>
<polyline points="131,-26.5 131,-52.5 "/>
<text text-anchor="middle" x="196.5" y="-35.7">mybuffer[2][1]</text>
<polyline points="262,-26.5 262,-52.5 "/>
<text text-anchor="middle" x="327.5" y="-35.7">mybuffer[2][2]</text>
<polyline points="0,-26.5 393,-26.5 "/>
<text text-anchor="middle" x="65.5" y="-9.7">mybuffer[3][0]</text>
<polyline points="131,-.5 131,-26.5 "/>
<text text-anchor="middle" x="196.5" y="-9.7">mybuffer[3][1]</text>
<polyline points="262,-.5 262,-26.5 "/>
<text text-anchor="middle" x="327.5" y="-9.7">mybuffer[3][2]</text>
</g>
</g>
</svg>
</div><p>For each scheduling token, you can use <a href="classtf_1_1Pipeflow.html#afee054e6a99965d4b3e36ff903227e6c" class="m-doc">tf::<wbr />Pipeflow::<wbr />line()</a> to get its line identifier and <a href="classtf_1_1Pipeflow.html#a4914c1f381a3016e98285b019cf60d6d" class="m-doc">tf::<wbr />Pipeflow::<wbr />pipe()</a> to get its pipe identifier. For example, if a scheduling token is processing an data element at the third pipe of the forth line, <a href="classtf_1_1Pipeflow.html#afee054e6a99965d4b3e36ff903227e6c" class="m-doc">tf::<wbr />Pipeflow::<wbr />line()</a> will return <code>3</code> and <a href="classtf_1_1Pipeflow.html#a4914c1f381a3016e98285b019cf60d6d" class="m-doc">tf::<wbr />Pipeflow::<wbr />pipe()</a> will return <code>2</code> (index starts from 0). To access the value propagated from the previous pipe, you can use <code>mybuffer[tf::Pipeflow::line()][tf::Pipeflow::pipe()-1]</code>. To stop the execution of the pipeline, you call <a href="classtf_1_1Pipeflow.html#a830b7f204cb87fff17e8d424918d9453" class="m-doc">tf::<wbr />Pipeflow::<wbr />stop()</a> at the first pipe. Once the stop signal has been triggered, the pipeline will stop scheduling any new tokens.</p><aside class="m-note m-info"><h4>Note</h4><p>Calling <a href="classtf_1_1Pipeflow.html#a830b7f204cb87fff17e8d424918d9453" class="m-doc">tf::<wbr />Pipeflow::<wbr />stop()</a> not at the first pipe has no effect on the pipeline scheduling.</p></aside><p>Our pipeline algorithm schedules tokens in a cyclic manner, with a factor of <code>num_lines</code>. That is, token <code>t</code> will be processed in line <code>t % num_lines</code>. The following snippet shows one of the possible outputs of this pipeline program:</p><pre class="m-code">pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span></pre><p>There are a total of five tokens running through three pipes. Each pipes prints its input data value, except the first pipe that prints its token identifier. Since the second pipe is a parallel pipe, the output can interleave.</p></section><section id="ConnectWithTasks"><h2><a href="#ConnectWithTasks">Connect Pipeline with Other Tasks</a></h2><p>You can connect the pipeline module task with other tasks to create a taskflow application that embeds one or multiple pipeline algorithms. We describe three common examples below:</p><ul><li><a href="ParallelPipeline.html#IterateAPipeline" class="m-doc">Example 1: Iterate a Pipeline</a></li><li><a href="ParallelPipeline.html#ConcatenateTwoPipelines" class="m-doc">Example 2: Concatenate Two Pipelines</a></li><li><a href="ParallelPipeline.html#DefineMultipleParallelPipelines" class="m-doc">Example 3: Define Multiple Parallel Pipelines</a></li></ul><section id="IterateAPipeline"><h3><a href="#IterateAPipeline">Example 1: Iterate a Pipeline</a></h3><p>This example emulates a data streaming application that iteratively runs a stream of data through a pipeline using conditional tasking. The taskflow graph consists of one pipeline module task and one condition task. The pipeline module task processes a stream of data. The condition task decides the availability of data and reruns the pipeline once the next stream of data is available.<br /></p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_pipes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom dataflow storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_pipes</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline consists of three pipes (serial-parallel-serial)</span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">13</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">     </span><span class="c1">// only 5 scheduling tokens are processed</span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">16</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">20</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;stage 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;stage 1: input mybuffer[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">29</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">32</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;stage 2: input mybuffer[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">38</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">41</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"> </span>
<span class="mi">44</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">conditional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">](){</span><span class="w"></span>
<span class="mi">45</span><span class="o">:</span><span class="w">   </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="mi">46</span><span class="o">:</span><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="mi">47</span><span class="o">:</span><span class="w">     </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Rerun the pipeline</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="mi">48</span><span class="o">:</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="mi">49</span><span class="o">:</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="mi">50</span><span class="o">:</span><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">51</span><span class="o">:</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">52</span><span class="o">:</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="mi">53</span><span class="o">:</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;conditional&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">54</span><span class="o">:</span><span class="w"></span>
<span class="mi">55</span><span class="o">:</span><span class="w"> </span><span class="c1">// build the pipeline graph using composition</span>
<span class="mi">56</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span><span class="w"></span>
<span class="mi">57</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">58</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">initial</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;initial</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">  </span><span class="p">})</span><span class="w"></span>
<span class="mi">59</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;initial&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">60</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">stop</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;stop</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="mi">61</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">62</span><span class="o">:</span><span class="w"></span>
<span class="mi">63</span><span class="o">:</span><span class="w"> </span><span class="c1">// specify the graph dependency</span>
<span class="mi">64</span><span class="o">:</span><span class="w"> </span><span class="n">initial</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">);</span><span class="w"></span>
<span class="mi">65</span><span class="o">:</span><span class="w"> </span><span class="n">pipeline</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">conditional</span><span class="p">);</span><span class="w"></span>
<span class="mi">66</span><span class="o">:</span><span class="w"> </span><span class="n">conditional</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="p">);</span><span class="w"></span>
<span class="mi">67</span><span class="o">:</span><span class="w"></span>
<span class="mi">68</span><span class="o">:</span><span class="w"> </span><span class="c1">// execute the taskflow</span>
<span class="mi">69</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>Debrief:</p><ul><li>Lines 4-5 define the structure of the pipeline scheduling framework</li><li>Line 8 defines the data storage as a two-dimensional array (<code>num_lines</code> by <code>num_pipes</code>)</li><li>Line 12 defines the number of lines in the pipeline</li><li>Lines 13-23 define the first serial pipe, which will stop the pipeline scheduling when <code>i</code> is <code>5</code><br /></li><li>Lines 25-32 define the second parallel pipe</li><li>Lines 34-41 define the third serial pipe</li><li>Lines 44-53 define a condition task which returns 0 when <code>N</code> is less than <code>2</code>, otherwise returns <code>1</code></li><li>Line 45 resets variable <code>i</code></li><li>Lines 56-57 define the pipeline graph using composition</li><li>Lines 58-61 define two static tasks</li><li>Line 64-66 define the task dependency</li><li>Line 69 executes the taskflow</li></ul><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">initial
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
Rerun the pipeline
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">5</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">6</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">6</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">6</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">7</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">7</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">7</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">8</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">8</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">8</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">9</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">9</span>
stage <span class="m">1</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">9</span>
stage <span class="m">2</span>: input mybuffer<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">10</span>
stop</pre><p>The pipeline runs twice as controlled by the condition task <code>conditional</code>. The starting token in the second run of the pipeline is <code>5</code> rather than <code>0</code> because the pipeline keeps a stateful number of tokens. The last token is <code>9</code>, which means the pipeline processes in total <code>10</code> scheduling tokens. The first five tokens (token <code>0</code> to <code>4</code>) are processed in the first run, and the remaining five tokens (token <code>5</code> to <code>9</code>) are processed in the second run. In the condition task, we use <code>N</code> as a decision-making counter to process the next stream of data.</p></section><section id="ConcatenateTwoPipelines"><h3><a href="#ConcatenateTwoPipelines">Example 2: Concatenate Two Pipelines</a></h3><p>This example demonstrates two concatenated pipelines where a sequence of data elements run synchronously from one pipeline to another pipeline. The first pipeline task precedes the second pipeline task.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_pipes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom dataflow storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_pipes</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_pipes</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">;</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_1 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">13</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_1</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 4 scheduling tokens</span>
<span class="mi">16</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">20</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 1, pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">       </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 1: input mybuffer_1[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">29</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">32</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 2: input mybuffer_1[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">38</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">41</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">44</span><span class="o">:</span><span class="w">  </span>
<span class="mi">45</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_2 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">46</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">47</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_2</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">48</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span>
<span class="mi">49</span><span class="o">:</span><span class="w">   </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mybuffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">50</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 4 scheduling tokens</span>
<span class="mi">51</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">52</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">53</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">54</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">55</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">56</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 2, pipe 0: input value = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="mi">57</span><span class="o">:</span><span class="w">       </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="mi">58</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">59</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">60</span><span class="o">:</span><span class="w"></span>
<span class="mi">61</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">62</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">63</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 1: input mybuffer_2[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">64</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">65</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">66</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding 1</span>
<span class="mi">67</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">68</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">69</span><span class="o">:</span><span class="w"></span>
<span class="mi">70</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">71</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">72</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 2: input mybuffer_2[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">73</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">74</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">75</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding 1</span>
<span class="mi">76</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">77</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">78</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">79</span><span class="o">:</span><span class="w"></span>
<span class="mi">80</span><span class="o">:</span><span class="w"> </span><span class="c1">// build the pipeline graph using composition</span>
<span class="mi">81</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_1</span><span class="p">).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">82</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_2</span><span class="p">).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">83</span><span class="o">:</span><span class="w"></span>
<span class="mi">84</span><span class="o">:</span><span class="w"> </span><span class="c1">// specify the graph dependency</span>
<span class="mi">85</span><span class="o">:</span><span class="w"> </span><span class="n">pipeline_1</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline_2</span><span class="p">);</span><span class="w"></span>
<span class="mi">86</span><span class="o">:</span><span class="w">  </span>
<span class="mi">87</span><span class="o">:</span><span class="w"> </span><span class="c1">// execute the taskflow</span>
<span class="mi">88</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre> <p><br />Debrief:</p><ul><li>Line 8 defines the data storage as a two-dimensional array (<code>num_lines</code> by <code>num_pipes</code>) for pipeline <code>1</code></li><li>Line 9 defines the data storage as a two-dimensional array (<code>num_lines</code> by <code>num_pipes</code>) for pipeline <code>2</code></li><li>Lines 14-24 define the first serial pipe in pipeline <code>pl_1</code></li><li>Lines 26-33 define the second parallel pipe in pipeline <code>pl_1</code></li><li>Lines 35-42 define the third serial pipe in pipeline <code>pl_1</code></li><li>Lines 48-59 define the first serial pipe in pipeline <code>pl_2</code> that takes the results of <code>pl_1</code> as the inputs<br /></li><li>Lines 61-68 define the second parallel pipe in pipeline <code>pl_2</code></li><li>Lines 70-77 define the third serial pipe in pipeline <code>pl_2</code></li><li>Lines 81-82 define the pipeline graphs using composition</li><li>Line 85 defines the task dependency</li><li>Line 88 runs the taskflow</li></ul><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input mybuffer_2<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input mybuffer_2<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input mybuffer_2<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input mybuffer_2<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">6</span></pre><p>The output in pipeline <code>pl_1</code> can be different from run to run, so does in pipeline <code>pl_2</code>, because the second pipe in both pipelines are parallel pipes. Due to the task dependency between <code>pipeline_1</code> and <code>pipeline_2</code>, the output of pipeline <code>pl_1</code> precedes the output of pipeline <code>pl_2</code>.</p></section><section id="DefineMultipleParallelPipelines"><h3><a href="#DefineMultipleParallelPipelines">Example 3: Define Multiple Parallel Pipelines</a></h3><p>This example creates two independent pipelines that run in parallel on different data sets.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_pipes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom dataflow storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_pipes</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_pipes</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">;</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_1 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">13</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_1</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 5 scheduling tokens</span>
<span class="mi">16</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">20</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 1, pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">       </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 1: input mybuffer_1[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">29</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">32</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 2: input mybuffer_1[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">38</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">41</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">44</span><span class="o">:</span><span class="w">  </span>
<span class="mi">45</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_2 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">46</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">47</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_2</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">48</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">49</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 2 scheduling tokens</span>
<span class="mi">50</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">51</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">52</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">53</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">54</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">55</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 2, pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">56</span><span class="o">:</span><span class="w">       </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pipeline&quot;</span><span class="p">;</span><span class="w"></span>
<span class="mi">57</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">58</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">59</span><span class="o">:</span><span class="w"></span>
<span class="mi">60</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">61</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">62</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 1: input mybuffer_2[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">63</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">64</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">65</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by concatenating &quot;_&quot;</span>
<span class="mi">66</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">];</span><span class="w"></span>
<span class="mi">67</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">68</span><span class="o">:</span><span class="w"></span>
<span class="mi">69</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">70</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">71</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 2: input mybuffer_2[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">72</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">73</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">74</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by concatenating &quot;2&quot;</span>
<span class="mi">75</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">];</span><span class="w"></span>
<span class="mi">76</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">77</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">78</span><span class="o">:</span><span class="w"></span>
<span class="mi">79</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_1</span><span class="p">)</span><span class="w"></span>
<span class="mi">80</span><span class="o">:</span><span class="w">                               </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">81</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_2</span><span class="p">)</span><span class="w"></span>
<span class="mi">82</span><span class="o">:</span><span class="w">                               </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">83</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;initial&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="mi">84</span><span class="o">:</span><span class="w">                               </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;initial&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">85</span><span class="o">:</span><span class="w"></span>
<span class="mi">86</span><span class="o">:</span><span class="w"> </span><span class="n">initial</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline_1</span><span class="p">,</span><span class="w"> </span><span class="n">pipeline_2</span><span class="p">);</span><span class="w"></span>
<span class="mi">87</span><span class="o">:</span><span class="w">  </span>
<span class="mi">88</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>Debrief:</p><ul><li>Line 8 defines the data storage as a two-dimensional array (<code>num_lines</code> by <code>num_pipes</code>) for pipeline <code>pl_1</code></li><li>Line 9 defines the data storage as a two-dimensional array (<code>num_lines</code> by <code>num_pipes</code>) for pipeline <code>pl_2</code></li><li>Lines 14-24 define the first serial pipe in pipeline <code>pl_1</code></li><li>Lines 26-33 define the second parallel pipe in pipeline <code>pl_1</code></li><li>Lines 35-42 define the third serial pipe in pipeline <code>pl_1</code></li><li>Lines 48-58 define the first serial pipe in pipeline <code>pl_2</code></li><li>Lines 60-67 define the second parallel pipe in pipeline <code>pl_2</code></li><li>Lines 69-76 define the third serial pipe in pipeline <code>pl_2</code></li><li>Lines 79-82 define the pipeline graphs using composition</li><li>Lines 83-84 define a static task.</li><li>Line 86 defines the task dependency</li><li>Line 88 runs the taskflow</li></ul><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">initial
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input mybuffer_2<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input mybuffer_2<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input mybuffer_2<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input mybuffer_2<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input mybuffer_2<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input mybuffer_2<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input mybuffer_2<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span></pre><p>Because pipeline <code>pl_1</code> and pipeline <code>pl_2</code> are running in parallel, their outputs may interleave.</p></section></section><section id="ResetPipeline"><h2><a href="#ResetPipeline">Reset a Pipeline</a></h2><p>Our pipeline scheduling framework keeps a stateful state for the total number of scheduled tokens at each run. You can reset the pipeline to the initial state using <a href="classtf_1_1Pipeline.html#a311d874b98de6f0def8a7d869e8d15bd" class="m-doc">tf::<wbr />Pipeline::<wbr />reset()</a>, where the identifier of the scheduling token will start from zero in the next run. Borrowed from the code in <a href="ParallelPipeline.html#IterateAPipeline" class="m-doc">Example 1: Iterate a Pipeline</a>, the example below resets the pipeline at the second iteration (line 47) so the scheduling token will start from zero.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_pipes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom dataflow storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_pipes</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline consists of three pipes (serial-parallel-serial)</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">13</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 5 scheduling tokens</span>
<span class="mi">16</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">20</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">       </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipe 1: input mybuffer_1[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">29</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">32</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">mybuffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipe 2: input mybuffer[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">38</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">41</span><span class="o">:</span><span class="w">     </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mybuffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()][</span><span class="n">pf</span><span class="p">.</span><span class="n">pipe</span><span class="p">()</span><span class="mi">-1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">44</span><span class="o">:</span><span class="w">  </span>
<span class="mi">45</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">conditional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"></span>
<span class="mi">46</span><span class="o">:</span><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">47</span><span class="o">:</span><span class="w">     </span><span class="n">pl</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span><span class="w"></span>
<span class="mi">48</span><span class="o">:</span><span class="w">     </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Rerun the pipeline</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="mi">49</span><span class="o">:</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="mi">50</span><span class="o">:</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="mi">51</span><span class="o">:</span><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">52</span><span class="o">:</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">53</span><span class="o">:</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="mi">54</span><span class="o">:</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;conditional&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">55</span><span class="o">:</span><span class="w"></span>
<span class="mi">56</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span><span class="w"></span>
<span class="mi">57</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">58</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">initial</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;initial&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="mi">59</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;initial&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">60</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">stop</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="mi">61</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">62</span><span class="o">:</span><span class="w"></span>
<span class="mi">63</span><span class="o">:</span><span class="w"> </span><span class="n">initial</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">);</span><span class="w"></span>
<span class="mi">64</span><span class="o">:</span><span class="w"> </span><span class="n">pipeline</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">conditional</span><span class="p">);</span><span class="w"></span>
<span class="mi">65</span><span class="o">:</span><span class="w"> </span><span class="n">conditional</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="p">);</span><span class="w"></span>
<span class="mi">66</span><span class="o">:</span><span class="w">  </span>
<span class="mi">67</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">initial
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
Rerun the pipeline
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">1</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">2</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">3</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">1</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">2</span>: input mybuffer_1<span class="o">[</span><span class="m">0</span><span class="o">][</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
stop</pre><p>The output can be different from run to run, since the second pipe is a parallel type. At the second iteration from the condition task, we reset the pipeline so the token identifier starts from <code>0</code> rather than <code>5</code>.</p></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim"></span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim"></span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Taskflow handbook is part of the <a href="https://taskflow.github.io">Taskflow project</a>, copyright  <a href="https://tsung-wei-huang.github.io/">Dr. Tsung-Wei Huang</a>, 2018&ndash;2021.<br />Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.14 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
