<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Taskflow Algorithms &raquo; Task-parallel Pipeline | Taskflow QuickStart</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <span id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">
        <a href="https://taskflow.github.io"><img src="taskflow_logo.png" alt="" />Taskflow</a> <span class="m-breadcrumb">|</span> <a href="index.html" class="m-thin">QuickStart</a>
      </span>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Handbook</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="Algorithms.html">Taskflow Algorithms</a> &raquo;</span>
          Task-parallel Pipeline
        </h1>
        <nav class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#TaskParallelPipelineIncludeHeaderFile">Include the Header</a></li>
            <li><a href="#UnderstandPipelineScheduling">Understand the Pipeline Scheduling Framework</a></li>
            <li><a href="#CreateATaskParallelPipelineModuleTask">Create a Task-parallel Pipeline Module Task</a></li>
            <li>
              <a href="#ConnectWithTasks">Connect Pipeline with Other Tasks</a>
              <ul>
                <li><a href="#IterateAPipeline">Example 1: Iterate a Pipeline</a></li>
                <li><a href="#ConcatenateTwoPipelines">Example 2: Concatenate Two Pipelines</a></li>
                <li><a href="#DefineMultipleTaskParallelPipelines">Example 3: Define Multiple Parallel Pipelines</a></li>
              </ul>
            </li>
            <li><a href="#ResetPipeline">Reset a Pipeline</a></li>
            <li><a href="#TaskParallelPipelineLearnMore">Learn More about Taskflow Pipeline</a></li>
          </ul>
        </nav>
<p>Taskflow provides a <em>task-parallel</em> pipeline programming framework for you to implement a pipeline algorithm. Pipeline parallelism refers to a parallel execution of multiple data tokens through a linear chain of pipes or stages. Each stage processes the data token sent from the previous stage, applies the given callable to that data token, and then sends the result to the next stage. Multiple data tokens can be processed simultaneously across different stages.</p><section id="TaskParallelPipelineIncludeHeaderFile"><h2><a href="#TaskParallelPipelineIncludeHeaderFile">Include the Header</a></h2><p>You need to include the header file, <code>taskflow/algorithm/pipeline.hpp</code>, for implementing task-parallel pipeline algorithms.</p><pre class="m-code"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;taskflow/algorithm/pipeline.hpp&gt;</span><span class="cp"></span></pre></section><section id="UnderstandPipelineScheduling"><h2><a href="#UnderstandPipelineScheduling">Understand the Pipeline Scheduling Framework</a></h2><p>A <a href="classtf_1_1Pipeline.html" class="m-doc">tf::<wbr />Pipeline</a> object is a <em>composable</em> graph to create a <em>pipeline scheduling framework</em> through a module task in a taskflow (see <a href="ComposableTasking.html" class="m-doc">Composable Tasking</a>). Unlike the conventional pipeline programming frameworks (e.g., Intel TBB Parallel Pipeline), Taskflow&#x27;s pipeline algorithm does not provide any data abstraction, which often restricts users from optimizing data layouts in their applications, but a flexible framework for users to customize their application data atop an efficient pipeline scheduling framework.</p><div class="m-graph"><svg style="width: 24.200rem; height: 33.200rem;" viewBox="0.00 0.00 242.00 332.00">
<g transform="scale(1 1) rotate(0) translate(4 328)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster0</title>
<polygon stroke-dasharray="5,2" points="8,-245 8,-316 226,-316 226,-245 8,-245"/>
<text text-anchor="middle" x="117" y="-304" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">line 0</text>
</g>
<g class="m-cluster">
<title>cluster1</title>
<polygon stroke-dasharray="5,2" points="8,-166 8,-237 226,-237 226,-166 8,-166"/>
<text text-anchor="middle" x="117" y="-225" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">line 1</text>
</g>
<g class="m-cluster">
<title>cluster2</title>
<polygon stroke-dasharray="5,2" points="8,-87 8,-158 226,-158 226,-87 8,-87"/>
<text text-anchor="middle" x="117" y="-146" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">line 2</text>
</g>
<g class="m-cluster">
<title>cluster3</title>
<polygon stroke-dasharray="5,2" points="8,-8 8,-79 226,-79 226,-8 8,-8"/>
<text text-anchor="middle" x="117" y="-67" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">line 3</text>
</g>
<g class="m-node m-flat">
<title>p00</title>
<ellipse cx="44" cy="-271" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="44" y="-268.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;0</text>
</g>
<g class="m-node m-flat">
<title>p10</title>
<ellipse cx="44" cy="-192" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="44" y="-189.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;0</text>
</g>
<g class="m-edge">
<title>p00&#45;&gt;p10</title>
<path d="M44,-252.6772C44,-243.1053 44,-231.1777 44,-220.4371"/>
<polygon points="47.5001,-220.2234 44,-210.2234 40.5001,-220.2234 47.5001,-220.2234"/>
</g>
<g class="m-node m-flat">
<title>p01</title>
<ellipse cx="117" cy="-271" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="117" y="-268.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p00&#45;&gt;p01</title>
<path d="M71.9453,-271C74.2809,-271 76.6165,-271 78.9521,-271"/>
<polygon points="79.1928,-274.5001 89.1928,-271 79.1928,-267.5001 79.1928,-274.5001"/>
</g>
<g class="m-node m-flat">
<title>p20</title>
<ellipse cx="44" cy="-113" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="44" y="-110.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;0</text>
</g>
<g class="m-edge">
<title>p10&#45;&gt;p20</title>
<path d="M44,-173.6772C44,-164.1053 44,-152.1777 44,-141.4371"/>
<polygon points="47.5001,-141.2234 44,-131.2234 40.5001,-141.2234 47.5001,-141.2234"/>
</g>
<g class="m-node m-flat">
<title>p11</title>
<ellipse cx="117" cy="-192" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="117" y="-189.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p10&#45;&gt;p11</title>
<path d="M71.9453,-192C74.2809,-192 76.6165,-192 78.9521,-192"/>
<polygon points="79.1928,-195.5001 89.1928,-192 79.1928,-188.5001 79.1928,-195.5001"/>
</g>
<g class="m-node m-flat">
<title>p30</title>
<ellipse cx="44" cy="-34" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="44" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;0</text>
</g>
<g class="m-edge">
<title>p20&#45;&gt;p30</title>
<path d="M44,-94.6772C44,-85.1053 44,-73.1777 44,-62.4371"/>
<polygon points="47.5001,-62.2234 44,-52.2234 40.5001,-62.2234 47.5001,-62.2234"/>
</g>
<g class="m-node m-flat">
<title>p21</title>
<ellipse cx="117" cy="-113" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="117" y="-110.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p20&#45;&gt;p21</title>
<path d="M71.9453,-113C74.2809,-113 76.6165,-113 78.9521,-113"/>
<polygon points="79.1928,-116.5001 89.1928,-113 79.1928,-109.5001 79.1928,-116.5001"/>
</g>
<g class="m-node m-flat">
<title>p31</title>
<ellipse cx="117" cy="-34" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="117" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;1</text>
</g>
<g class="m-edge">
<title>p30&#45;&gt;p31</title>
<path d="M71.9453,-34C74.2809,-34 76.6165,-34 78.9521,-34"/>
<polygon points="79.1928,-37.5001 89.1928,-34 79.1928,-30.5001 79.1928,-37.5001"/>
</g>
<g class="m-node m-flat">
<title>p02</title>
<ellipse cx="190" cy="-271" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="190" y="-268.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p01&#45;&gt;p02</title>
<path d="M144.9453,-271C147.2809,-271 149.6165,-271 151.9521,-271"/>
<polygon points="152.1928,-274.5001 162.1928,-271 152.1928,-267.5001 152.1928,-274.5001"/>
</g>
<g class="m-node m-flat">
<title>p12</title>
<ellipse cx="190" cy="-192" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="190" y="-189.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p11&#45;&gt;p12</title>
<path d="M144.9453,-192C147.2809,-192 149.6165,-192 151.9521,-192"/>
<polygon points="152.1928,-195.5001 162.1928,-192 152.1928,-188.5001 152.1928,-195.5001"/>
</g>
<g class="m-node m-flat">
<title>p22</title>
<ellipse cx="190" cy="-113" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="190" y="-110.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p21&#45;&gt;p22</title>
<path d="M144.9453,-113C147.2809,-113 149.6165,-113 151.9521,-113"/>
<polygon points="152.1928,-116.5001 162.1928,-113 152.1928,-109.5001 152.1928,-116.5001"/>
</g>
<g class="m-node m-flat">
<title>p32</title>
<ellipse cx="190" cy="-34" rx="27.8353" ry="18"/>
<text text-anchor="middle" x="190" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipe&#45;2</text>
</g>
<g class="m-edge">
<title>p31&#45;&gt;p32</title>
<path d="M144.9453,-34C147.2809,-34 149.6165,-34 151.9521,-34"/>
<polygon points="152.1928,-37.5001 162.1928,-34 152.1928,-30.5001 152.1928,-37.5001"/>
</g>
<g class="m-edge">
<title>p02&#45;&gt;p12</title>
<path d="M190,-252.6772C190,-243.1053 190,-231.1777 190,-220.4371"/>
<polygon points="193.5001,-220.2234 190,-210.2234 186.5001,-220.2234 193.5001,-220.2234"/>
</g>
<g class="m-edge">
<title>p12&#45;&gt;p22</title>
<path d="M190,-173.6772C190,-164.1053 190,-152.1777 190,-141.4371"/>
<polygon points="193.5001,-141.2234 190,-131.2234 186.5001,-141.2234 193.5001,-141.2234"/>
</g>
<g class="m-edge">
<title>p22&#45;&gt;p32</title>
<path d="M190,-94.6772C190,-85.1053 190,-73.1777 190,-62.4371"/>
<polygon points="193.5001,-62.2234 190,-52.2234 186.5001,-62.2234 193.5001,-62.2234"/>
</g>
</g>
</svg>
</div><p>The figure above gives an example of our pipeline scheduling framework. The framework consists of three <em>pipes</em> (serial-parallel-serial stages) and four <em>lines</em> (maximum parallelism), where each line processes at most one data token. A pipeline of three pipes and four lines will propagate each data token through a sequential chain of three pipes and can simultaneously process up to four data tokens at the four lines. Each edge represents a task dependency. For example, the edge from <code>pipe-0</code> to <code>pipe-1</code> in line <code>0</code> represents the task dependency between the first and the second pipes in the first line; the edge from <code>pipe-0</code> in line <code>0</code> to <code>pipe-0</code> in line <code>1</code> represents the task dependency between two adjacent lines when processing two data tokens at the same pipe. Each pipe can be either a <em>serial</em> type or a <em>parallel</em> type, where a serial pipe processes data tokens sequentially and a parallel pipe processes different data tokens simultaneously.</p><aside class="m-note m-info"><h4>Note</h4><p>Due to the nature of pipeline, Taskflow requires the first pipe to be a serial type. The pipeline scheduling algorithm operates in a circular fashion with a factor of line count.</p></aside></section><section id="CreateATaskParallelPipelineModuleTask"><h2><a href="#CreateATaskParallelPipelineModuleTask">Create a Task-parallel Pipeline Module Task</a></h2><p>Taskflow leverages modern C++ and template techniques to strike a balance between the <em>expressiveness</em> and <em>generality</em> in designing the pipeline programming model. In general, there are three steps to create a task-parallel pipeline application:</p><ol><li>Define the pipeline structure (e.g., pipe type, pipe callable, stopping rule, line count)</li><li>Define the data storage and layout, if needed for the application</li><li>Define the pipeline taskflow graph using composition</li></ol><p>The following code creates a pipeline scheduling framework using the example from the previous section. The framework schedules a total of five <em>scheduling tokens</em> labeled from 0 to 4. The first pipe stores the token identifier in a custom data storage, <code>buffer</code>, and each of the rest pipes adds one to the input data from the result of the previous pipe and stores the result into the corresponding line entry in the buffer.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="c1">// maximum parallelism - each line processes one token at a time</span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom data storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline consists of three pipes (serial-parallel-serial)</span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">13</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 5 scheduling tokens</span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">16</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">20</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipe 1: input buffer[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">29</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">32</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipe 2: input buffer[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">38</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">41</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"></span>
<span class="mi">44</span><span class="o">:</span><span class="w"> </span><span class="c1">// build the pipeline graph using composition</span>
<span class="mi">45</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl</span><span class="p">).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">46</span><span class="o">:</span><span class="w"></span>
<span class="mi">47</span><span class="o">:</span><span class="w"> </span><span class="c1">// execute the taskflow</span>
<span class="mi">48</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>Debrief:</p><ul><li>Lines 4-5 define the structure of the pipeline scheduling framework</li><li>Line 8 defines the data storage as an one-dimensional array of <code>num_lines</code> integers</li><li>Line 12 defines the number of lines in the pipeline</li><li>Lines 13-23 define the first serial pipe, which will stop the pipeline scheduling at the fifth token</li><li>Lines 25-32 define the second parallel pipe</li><li>Lines 34-41 define the third serial pipe</li><li>Line 45 defines the pipeline taskflow graph using composition</li><li>Line 48 executes the taskflow</li></ul><p>Taskflow leverages <a href="RuntimeTasking.html" class="m-doc">Interact with the Runtime</a> and <a href="ComposableTasking.html" class="m-doc">Composable Tasking</a> to implement the pipeline scheduling framework. The taskflow graph of this pipeline example is shown as follows, where 1) one condition task is used to decide which runtime task to run and 2) four runtime tasks is used to schedule tokens at four parallel lines, respectively.</p><div class="m-graph"><svg style="width: 41.600rem; height: 21.600rem;" viewBox="0.00 0.00 416.00 216.00">
<g transform="scale(1 1) rotate(0) translate(4 212)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster_p0x7ffc47e53358</title>
<polygon points="8,-129 8,-200 106,-200 106,-129 8,-129"/>
<text text-anchor="middle" x="57" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Taskflow</text>
</g>
<g class="m-cluster">
<title>cluster_p0x7ffc47e53220</title>
<polygon points="114,-8 114,-200 400,-200 400,-8 114,-8"/>
<text text-anchor="middle" x="257" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">m1</text>
</g>
<g class="m-node m-flat">
<title>p0x1878a88</title>
<polygon points="98,-173 20,-173 16,-169 16,-137 94,-137 98,-141 98,-173"/>
<polyline points="94,-169 16,-169 "/>
<polyline points="94,-169 94,-137 "/>
<polyline points="94,-169 98,-173 "/>
<text text-anchor="middle" x="57" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipeline [m1]</text>
</g>
<g class="m-node">
<title>p0x1878600</title>
<polygon points="257,-173 223.8992,-155 257,-137 290.1008,-155 257,-173"/>
<text text-anchor="middle" x="257" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">cond</text>
</g>
<g class="m-node m-flat">
<title>p0x18786e8</title>
<polygon points="176,-52 122,-52 122,-48 118,-48 118,-44 122,-44 122,-24 118,-24 118,-20 122,-20 122,-16 176,-16 176,-52"/>
<polyline points="122,-48 126,-48 126,-44 122,-44 "/>
<polyline points="122,-24 126,-24 126,-20 122,-20 "/>
<text text-anchor="middle" x="149" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;0</text>
</g>
<g class="m-edge">
<title>p0x1878600&#45;&gt;p0x18786e8</title>
<path stroke-dasharray="5,2" d="M245.8489,-142.5066C228.4613,-123.0261 194.5317,-85.0123 171.8111,-59.5569"/>
<polygon points="174.4206,-57.2243 165.1504,-52.0945 169.1982,-61.8856 174.4206,-57.2243"/>
<text text-anchor="middle" x="209.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">0</text>
</g>
<g class="m-node m-flat">
<title>p0x18787d0</title>
<polygon points="248,-52 194,-52 194,-48 190,-48 190,-44 194,-44 194,-24 190,-24 190,-20 194,-20 194,-16 248,-16 248,-52"/>
<polyline points="194,-48 198,-48 198,-44 194,-44 "/>
<polyline points="194,-24 198,-24 198,-20 194,-20 "/>
<text text-anchor="middle" x="221" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;1</text>
</g>
<g class="m-edge">
<title>p0x1878600&#45;&gt;p0x18787d0</title>
<path stroke-dasharray="5,2" d="M252.2936,-139.1814C246.4568,-119.5631 236.4064,-85.7825 229.2713,-61.8008"/>
<polygon points="232.6191,-60.7793 226.4127,-52.1927 225.9098,-62.7756 232.6191,-60.7793"/>
<text text-anchor="middle" x="243.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">1</text>
</g>
<g class="m-node m-flat">
<title>p0x18788b8</title>
<polygon points="320,-52 266,-52 266,-48 262,-48 262,-44 266,-44 266,-24 262,-24 262,-20 266,-20 266,-16 320,-16 320,-52"/>
<polyline points="266,-48 270,-48 270,-44 266,-44 "/>
<polyline points="266,-24 270,-24 270,-20 266,-20 "/>
<text text-anchor="middle" x="293" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;2</text>
</g>
<g class="m-edge">
<title>p0x1878600&#45;&gt;p0x18788b8</title>
<path stroke-dasharray="5,2" d="M261.7064,-139.1814C267.5432,-119.5631 277.5936,-85.7825 284.7287,-61.8008"/>
<polygon points="288.0902,-62.7756 287.5873,-52.1927 281.3809,-60.7793 288.0902,-62.7756"/>
<text text-anchor="middle" x="279.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">2</text>
</g>
<g class="m-node m-flat">
<title>p0x18789a0</title>
<polygon points="392,-52 338,-52 338,-48 334,-48 334,-44 338,-44 338,-24 334,-24 334,-20 338,-20 338,-16 392,-16 392,-52"/>
<polyline points="338,-48 342,-48 342,-44 338,-44 "/>
<polyline points="338,-24 342,-24 342,-20 338,-20 "/>
<text text-anchor="middle" x="365" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;3</text>
</g>
<g class="m-edge">
<title>p0x1878600&#45;&gt;p0x18789a0</title>
<path stroke-dasharray="5,2" d="M268.1511,-142.5066C285.5387,-123.0261 319.4683,-85.0123 342.1889,-59.5569"/>
<polygon points="344.8018,-61.8856 348.8496,-52.0945 339.5794,-57.2243 344.8018,-61.8856"/>
<text text-anchor="middle" x="317.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">3</text>
</g>
</g>
</svg>
</div><p>In this example, we customize the data storage, <code>buffer</code>, as an one-dimensional array of 4 integers, since the pipeline structure defines only four parallel lines. Each entry of <code>buffer</code> stores stores the data being processed in the corresponding line. For example, <code>buffer[1]</code> stores the processed data at line <code>1</code>. The following figure shows the data layout of <code>buffer</code>.</p><div class="m-graph"><svg style="width: 19.900rem; height: 8.500rem;" viewBox="0.00 0.00 199.00 85.00">
<g transform="scale(1 1) rotate(0) translate(4 81)">
<title>structs</title>
<g class="m-node m-flat">
<title>struct1</title>
<polygon points="0,-.5 0,-76.5 191,-76.5 191,-.5 0,-.5"/>
<text text-anchor="middle" x="95.5" y="-64.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">buffer[0] (processes token at line 0)</text>
<polyline points="0,-57.5 191,-57.5 "/>
<text text-anchor="middle" x="95.5" y="-45.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">buffer[1] (processes token at line 1)</text>
<polyline points="0,-38.5 191,-38.5 "/>
<text text-anchor="middle" x="95.5" y="-26.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">buffer[2] (processes token at line 2)</text>
<polyline points="0,-19.5 191,-19.5 "/>
<text text-anchor="middle" x="95.5" y="-7.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">buffer[3] (processes token at line 3)</text>
</g>
</g>
</svg>
</div><aside class="m-note m-info"><h4>Note</h4><p>In practice, you may need to add padding to the data type of the buffer or align it with the cacheline size to avoid false sharing. If the data type varies at different pipes, you can use <a href="https://en.cppreference.com/w/cpp/utility/variant">std::<wbr />variant</a> to store the data types in a uniform storage.</p></aside><p>For each scheduling token, you can use <a href="classtf_1_1Pipeflow.html#afee054e6a99965d4b3e36ff903227e6c" class="m-doc">tf::<wbr />Pipeflow::<wbr />line()</a> to get its line identifier and <a href="classtf_1_1Pipeflow.html#a4914c1f381a3016e98285b019cf60d6d" class="m-doc">tf::<wbr />Pipeflow::<wbr />pipe()</a> to get its pipe identifier. For example, if a scheduling token is at the third pipe of the forth line, <a href="classtf_1_1Pipeflow.html#afee054e6a99965d4b3e36ff903227e6c" class="m-doc">tf::<wbr />Pipeflow::<wbr />line()</a> will return <code>3</code> and <a href="classtf_1_1Pipeflow.html#a4914c1f381a3016e98285b019cf60d6d" class="m-doc">tf::<wbr />Pipeflow::<wbr />pipe()</a> will return <code>2</code> (index starts from 0). To stop the execution of the pipeline, you need to call <a href="classtf_1_1Pipeflow.html#a830b7f204cb87fff17e8d424918d9453" class="m-doc">tf::<wbr />Pipeflow::<wbr />stop()</a> at the first pipe. Once the stop signal has been triggered, the pipeline will stop scheduling any new tokens after the callable. As we can see from this example, <a href="classtf_1_1Pipeline.html" class="m-doc">tf::<wbr />Pipeline</a> gives you the full control to customize your application data on top of a pipeline scheduling framework.</p><aside class="m-note m-info"><h4>Note</h4><ol><li>Calling <a href="classtf_1_1Pipeflow.html#a830b7f204cb87fff17e8d424918d9453" class="m-doc">tf::<wbr />Pipeflow::<wbr />stop()</a> not at the first pipe has no effect on the pipeline scheduling.</li><li>In most cases, <a href="http://en.cppreference.com/w/cpp/thread/thread/hardware_concurrency.html" class="m-doc-external">std::<wbr />thread::<wbr />hardware_concurrency</a> is a good number for line count.</li></ol></aside><p>Our pipeline algorithm schedules tokens in a <em>circular</em> manner, with a factor of <code>num_lines</code>. That is, token <code>t</code> will be processed at line <code>t % num_lines</code>. The following snippet shows one of the possible outputs of this pipeline program:</p><pre class="m-code">pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span></pre><p>There are a total of five tokens running through three pipes. Each pipes prints its input data value, except the first pipe that prints its token identifier. Since the second pipe is a parallel pipe, the output can interleave.</p></section><section id="ConnectWithTasks"><h2><a href="#ConnectWithTasks">Connect Pipeline with Other Tasks</a></h2><p>You can connect the pipeline module task with other tasks to create a taskflow application that embeds one or multiple pipeline algorithms. We describe three common examples below:</p><ul><li><a href="TaskParallelPipeline.html#IterateAPipeline" class="m-doc">Example 1: Iterate a Pipeline</a></li><li><a href="TaskParallelPipeline.html#ConcatenateTwoPipelines" class="m-doc">Example 2: Concatenate Two Pipelines</a></li><li><a href="TaskParallelPipeline.html#DefineMultipleTaskParallelPipelines" class="m-doc">Example 3: Define Multiple Parallel Pipelines</a></li></ul><section id="IterateAPipeline"><h3><a href="#IterateAPipeline">Example 1: Iterate a Pipeline</a></h3><p>This example emulates a data streaming application that iteratively runs a stream of data through a pipeline using conditional tasking. The taskflow graph consists of one pipeline module task and one condition task. The pipeline module task processes a stream of data. The condition task decides the availability of data and reruns the pipeline when the next stream of data becomes available.<br /></p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">  </span><span class="c1">// maximum parallelism of the pipeline</span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom data storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline consists of three pipes (serial-parallel-serial)</span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">13</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">     </span><span class="c1">// only 5 scheduling tokens are processed</span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">16</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">20</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;stage 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;stage 1: input buffer[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">29</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">32</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;stage 2: input buffer[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">38</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">41</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"> </span>
<span class="mi">44</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">conditional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">](){</span><span class="w"></span>
<span class="mi">45</span><span class="o">:</span><span class="w">   </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="mi">46</span><span class="o">:</span><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="mi">47</span><span class="o">:</span><span class="w">     </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Rerun the pipeline</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="mi">48</span><span class="o">:</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="mi">49</span><span class="o">:</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="mi">50</span><span class="o">:</span><span class="w">   </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">51</span><span class="o">:</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">52</span><span class="o">:</span><span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="mi">53</span><span class="o">:</span><span class="w"> </span><span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;conditional&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">54</span><span class="o">:</span><span class="w"></span>
<span class="mi">55</span><span class="o">:</span><span class="w"> </span><span class="c1">// build the pipeline graph using composition</span>
<span class="mi">56</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span><span class="w"></span>
<span class="mi">57</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">58</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">initial</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;initial</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w">  </span><span class="p">})</span><span class="w"></span>
<span class="mi">59</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;initial&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">60</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">stop</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;stop</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="mi">61</span><span class="o">:</span><span class="w">                             </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">62</span><span class="o">:</span><span class="w"></span>
<span class="mi">63</span><span class="o">:</span><span class="w"> </span><span class="c1">// specify the graph dependency</span>
<span class="mi">64</span><span class="o">:</span><span class="w"> </span><span class="n">initial</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">);</span><span class="w"></span>
<span class="mi">65</span><span class="o">:</span><span class="w"> </span><span class="n">pipeline</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">conditional</span><span class="p">);</span><span class="w"></span>
<span class="mi">66</span><span class="o">:</span><span class="w"> </span><span class="n">conditional</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="p">);</span><span class="w"></span>
<span class="mi">67</span><span class="o">:</span><span class="w"></span>
<span class="mi">68</span><span class="o">:</span><span class="w"> </span><span class="c1">// execute the taskflow</span>
<span class="mi">69</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>Debrief:</p><ul><li>Lines 4-5 define the structure of the pipeline scheduling framework</li><li>Line 8 defines the data storage as an one-dimensional array (<code>num_lines</code> integers)</li><li>Line 12 defines the number of lines in the pipeline</li><li>Lines 13-23 define the first serial pipe, which will stop the pipeline scheduling when <code>i</code> is <code>5</code><br /></li><li>Lines 25-32 define the second parallel pipe</li><li>Lines 34-41 define the third serial pipe</li><li>Lines 44-53 define a condition task which returns 0 when <code>N</code> is less than <code>2</code>, otherwise returns <code>1</code></li><li>Line 45 resets variable <code>i</code></li><li>Lines 56-57 define the pipeline graph using composition</li><li>Lines 58-61 define two static tasks</li><li>Line 64-66 define the task dependency</li><li>Line 69 executes the taskflow</li></ul><p>The taskflow graph of this pipeline example is illustrated as follows:</p><div class="m-graph"><svg style="width: 45.200rem; height: 45.800rem;" viewBox="0.00 0.00 452.00 458.00">
<g transform="scale(1 1) rotate(0) translate(4 454)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster_p0x7fff4f1276d8</title>
<polygon points="8,-8 8,-442 142,-442 142,-8 8,-8"/>
<text text-anchor="middle" x="75" y="-430" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Taskflow</text>
</g>
<g class="m-cluster">
<title>cluster_p0x7fff4f127590</title>
<polygon points="150,-250 150,-442 436,-442 436,-250 150,-250"/>
<text text-anchor="middle" x="293" y="-430" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">m1</text>
</g>
<g class="m-node m-flat">
<title>p0xdf4c58</title>
<ellipse cx="66" cy="-397" rx="27" ry="18"/>
<text text-anchor="middle" x="66" y="-394.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">initial</text>
</g>
<g class="m-node m-flat">
<title>p0xdf4b70</title>
<polygon points="107,-294 29,-294 25,-290 25,-258 103,-258 107,-262 107,-294"/>
<polyline points="103,-290 25,-290 "/>
<polyline points="103,-290 103,-258 "/>
<polyline points="103,-290 107,-294 "/>
<text text-anchor="middle" x="66" y="-273.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipeline [m1]</text>
</g>
<g class="m-edge">
<title>p0xdf4c58&#45;&gt;p0xdf4b70</title>
<path d="M66,-378.8851C66,-359.1928 66,-327.4608 66,-304.439"/>
<polygon points="69.5001,-304.2387 66,-294.2388 62.5001,-304.2388 69.5001,-304.2387"/>
</g>
<g class="m-node">
<title>p0xdf4a88</title>
<polygon points="75,-173 15.7855,-155 75,-137 134.2145,-155 75,-173"/>
<text text-anchor="middle" x="75" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">conditional</text>
</g>
<g class="m-edge">
<title>p0xdf4b70&#45;&gt;p0xdf4a88</title>
<path d="M65.6444,-257.7609C65.5395,-244.4926 65.712,-226.1067 67,-210 67.7218,-200.9737 68.9894,-191.1743 70.3057,-182.3815"/>
<polygon points="73.7989,-182.6986 71.902,-172.275 66.8847,-181.6065 73.7989,-182.6986"/>
</g>
<g class="m-edge">
<title>p0xdf4a88&#45;&gt;p0xdf4b70</title>
<path stroke-dasharray="5,2" d="M74.7144,-173.0747C74.5651,-179.0974 74.3396,-185.8404 74,-192 72.8215,-213.3748 72.0711,-218.6931 70,-240 69.7639,-242.4293 69.5074,-244.9494 69.2422,-247.477"/>
<polygon points="65.7326,-247.3766 68.1324,-257.696 72.6917,-248.1324 65.7326,-247.3766"/>
<text text-anchor="middle" x="75.5" y="-213" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">0</text>
</g>
<g class="m-node m-flat">
<title>p0xdf4d40</title>
<ellipse cx="75" cy="-34" rx="34.2855" ry="18"/>
<text text-anchor="middle" x="75" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">terminal</text>
</g>
<g class="m-edge">
<title>p0xdf4a88&#45;&gt;p0xdf4d40</title>
<path stroke-dasharray="5,2" d="M75,-136.8851C75,-117.1928 75,-85.4608 75,-62.439"/>
<polygon points="78.5001,-62.2387 75,-52.2388 71.5001,-62.2388 78.5001,-62.2387"/>
<text text-anchor="middle" x="78.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">1</text>
</g>
<g class="m-node">
<title>p0xdf4600</title>
<polygon points="293,-415 259.8992,-397 293,-379 326.1008,-397 293,-415"/>
<text text-anchor="middle" x="293" y="-394.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">cond</text>
</g>
<g class="m-node m-flat">
<title>p0xdf46e8</title>
<polygon points="212,-294 158,-294 158,-290 154,-290 154,-286 158,-286 158,-266 154,-266 154,-262 158,-262 158,-258 212,-258 212,-294"/>
<polyline points="158,-290 162,-290 162,-286 158,-286 "/>
<polyline points="158,-266 162,-266 162,-262 158,-262 "/>
<text text-anchor="middle" x="185" y="-273.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;0</text>
</g>
<g class="m-edge">
<title>p0xdf4600&#45;&gt;p0xdf46e8</title>
<path stroke-dasharray="5,2" d="M281.8489,-384.5066C264.4613,-365.0261 230.5317,-327.0123 207.8111,-301.5569"/>
<polygon points="210.4206,-299.2243 201.1504,-294.0945 205.1982,-303.8856 210.4206,-299.2243"/>
<text text-anchor="middle" x="245.5" y="-334" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">0</text>
</g>
<g class="m-node m-flat">
<title>p0xdf47d0</title>
<polygon points="284,-294 230,-294 230,-290 226,-290 226,-286 230,-286 230,-266 226,-266 226,-262 230,-262 230,-258 284,-258 284,-294"/>
<polyline points="230,-290 234,-290 234,-286 230,-286 "/>
<polyline points="230,-266 234,-266 234,-262 230,-262 "/>
<text text-anchor="middle" x="257" y="-273.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;1</text>
</g>
<g class="m-edge">
<title>p0xdf4600&#45;&gt;p0xdf47d0</title>
<path stroke-dasharray="5,2" d="M288.2936,-381.1814C282.4568,-361.5631 272.4064,-327.7825 265.2713,-303.8008"/>
<polygon points="268.6191,-302.7793 262.4127,-294.1927 261.9098,-304.7756 268.6191,-302.7793"/>
<text text-anchor="middle" x="279.5" y="-334" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">1</text>
</g>
<g class="m-node m-flat">
<title>p0xdf48b8</title>
<polygon points="356,-294 302,-294 302,-290 298,-290 298,-286 302,-286 302,-266 298,-266 298,-262 302,-262 302,-258 356,-258 356,-294"/>
<polyline points="302,-290 306,-290 306,-286 302,-286 "/>
<polyline points="302,-266 306,-266 306,-262 302,-262 "/>
<text text-anchor="middle" x="329" y="-273.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;2</text>
</g>
<g class="m-edge">
<title>p0xdf4600&#45;&gt;p0xdf48b8</title>
<path stroke-dasharray="5,2" d="M297.7064,-381.1814C303.5432,-361.5631 313.5936,-327.7825 320.7287,-303.8008"/>
<polygon points="324.0902,-304.7756 323.5873,-294.1927 317.3809,-302.7793 324.0902,-304.7756"/>
<text text-anchor="middle" x="315.5" y="-334" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">2</text>
</g>
<g class="m-node m-flat">
<title>p0xdf49a0</title>
<polygon points="428,-294 374,-294 374,-290 370,-290 370,-286 374,-286 374,-266 370,-266 370,-262 374,-262 374,-258 428,-258 428,-294"/>
<polyline points="374,-290 378,-290 378,-286 374,-286 "/>
<polyline points="374,-266 378,-266 378,-262 374,-262 "/>
<text text-anchor="middle" x="401" y="-273.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;3</text>
</g>
<g class="m-edge">
<title>p0xdf4600&#45;&gt;p0xdf49a0</title>
<path stroke-dasharray="5,2" d="M304.1511,-384.5066C321.5387,-365.0261 355.4683,-327.0123 378.1889,-301.5569"/>
<polygon points="380.8018,-303.8856 384.8496,-294.0945 375.5794,-299.2243 380.8018,-303.8856"/>
<text text-anchor="middle" x="353.5" y="-334" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">3</text>
</g>
</g>
</svg>
</div><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">initial
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
Rerun the pipeline
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">5</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">6</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">6</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">6</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">7</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">7</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">7</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">8</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">8</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">8</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">9</span>
stage <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">9</span>
stage <span class="m">1</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">9</span>
stage <span class="m">2</span>: input buffer<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">10</span>
stop</pre><p>The pipeline runs twice as controlled by the condition task <code>conditional</code>. The starting token in the second run of the pipeline is <code>5</code> rather than <code>0</code> because the pipeline keeps a stateful number of tokens. The last token is <code>9</code>, which means the pipeline processes in total <code>10</code> scheduling tokens. The first five tokens (token <code>0</code> to <code>4</code>) are processed in the first run, and the remaining five tokens (token <code>5</code> to <code>9</code>) are processed in the second run. In the condition task, we use <code>N</code> as a decision-making counter to process the next stream of data.</p></section><section id="ConcatenateTwoPipelines"><h3><a href="#ConcatenateTwoPipelines">Example 2: Concatenate Two Pipelines</a></h3><p>This example demonstrates two concatenated pipelines where a sequence of data tokens run synchronously from one pipeline to another pipeline. The first pipeline task precedes the second pipeline task.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="c1">// define the maximum parallelism of the pipeline</span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom data storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">;</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_1 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">13</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_1</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 4 scheduling tokens</span>
<span class="mi">16</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">20</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 1, pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">       </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 1: input buffer_1[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">29</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">32</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 2: input buffer_1[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">38</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">41</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">44</span><span class="o">:</span><span class="w">  </span>
<span class="mi">45</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_2 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">46</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">47</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_2</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">48</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span>
<span class="mi">49</span><span class="o">:</span><span class="w">   </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">buffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">50</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 4 scheduling tokens</span>
<span class="mi">51</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">52</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">53</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">54</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">55</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">56</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 2, pipe 0: input value = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]);</span><span class="w"></span>
<span class="mi">57</span><span class="o">:</span><span class="w">       </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()];</span><span class="w"></span>
<span class="mi">58</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">59</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">60</span><span class="o">:</span><span class="w"></span>
<span class="mi">61</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">62</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">63</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 1: input buffer_2[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">64</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">65</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">66</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding 1</span>
<span class="mi">67</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">68</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">69</span><span class="o">:</span><span class="w"></span>
<span class="mi">70</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">71</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">72</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 2: input buffer_2[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">73</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">74</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">75</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding 1</span>
<span class="mi">76</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">77</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">78</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">79</span><span class="o">:</span><span class="w"></span>
<span class="mi">80</span><span class="o">:</span><span class="w"> </span><span class="c1">// build the pipeline graph using composition</span>
<span class="mi">81</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_1</span><span class="p">).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">82</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_2</span><span class="p">).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">83</span><span class="o">:</span><span class="w"></span>
<span class="mi">84</span><span class="o">:</span><span class="w"> </span><span class="c1">// specify the graph dependency</span>
<span class="mi">85</span><span class="o">:</span><span class="w"> </span><span class="n">pipeline_1</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline_2</span><span class="p">);</span><span class="w"></span>
<span class="mi">86</span><span class="o">:</span><span class="w">  </span>
<span class="mi">87</span><span class="o">:</span><span class="w"> </span><span class="c1">// execute the taskflow</span>
<span class="mi">88</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre> <p><br />Debrief:</p><ul><li>Line 8 defines the data storage (<code>num_lines</code> integers) for pipeline <code>pl_1</code></li><li>Line 9 defines the data storage (<code>num_lines</code> integers) for pipeline <code>pl_2</code></li><li>Lines 14-24 define the first serial pipe in <code>pl_1</code></li><li>Lines 26-33 define the second parallel pipe in <code>pl_1</code></li><li>Lines 35-42 define the third serial pipe in <code>pl_1</code></li><li>Lines 48-59 define the first serial pipe in <code>pl_2</code> that takes the results of <code>pl_1</code> as inputs</li><li>Lines 61-68 define the second parallel pipe in <code>pl_2</code></li><li>Lines 70-77 define the third serial pipe in <code>pl_2</code></li><li>Lines 81-82 define the pipeline graphs using composition</li><li>Line 85 defines the task dependency</li><li>Line 88 runs the taskflow</li></ul><p>The taskflow graph of this pipeline example is illustrated as follows:</p><div class="m-graph"><svg style="width: 72.200rem; height: 21.600rem;" viewBox="0.00 0.00 722.00 216.00">
<g transform="scale(1 1) rotate(0) translate(4 212)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster_p0x7ffeaf4d98d8</title>
<polygon points="8,-8 8,-200 118,-200 118,-8 8,-8"/>
<text text-anchor="middle" x="63" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Taskflow</text>
</g>
<g class="m-cluster">
<title>cluster_p0x7ffeaf4d9510</title>
<polygon points="126,-8 126,-200 412,-200 412,-8 126,-8"/>
<text text-anchor="middle" x="269" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">m2</text>
</g>
<g class="m-cluster">
<title>cluster_p0x7ffeaf4d95b0</title>
<polygon points="420,-8 420,-200 706,-200 706,-8 420,-8"/>
<text text-anchor="middle" x="563" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">m1</text>
</g>
<g class="m-node m-flat">
<title>p0x1da4f10</title>
<polygon points="109.5,-173 20.5,-173 16.5,-169 16.5,-137 105.5,-137 109.5,-141 109.5,-173"/>
<polyline points="105.5,-169 16.5,-169 "/>
<polyline points="105.5,-169 105.5,-137 "/>
<polyline points="105.5,-169 109.5,-173 "/>
<text text-anchor="middle" x="63" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipeline_1 [m1]</text>
</g>
<g class="m-node m-flat">
<title>p0x1da4ff8</title>
<polygon points="109.5,-52 20.5,-52 16.5,-48 16.5,-16 105.5,-16 109.5,-20 109.5,-52"/>
<polyline points="105.5,-48 16.5,-48 "/>
<polyline points="105.5,-48 105.5,-16 "/>
<polyline points="105.5,-48 109.5,-52 "/>
<text text-anchor="middle" x="63" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipeline_2 [m2]</text>
</g>
<g class="m-edge">
<title>p0x1da4f10&#45;&gt;p0x1da4ff8</title>
<path d="M63,-136.8851C63,-117.1928 63,-85.4608 63,-62.439"/>
<polygon points="66.5001,-62.2387 63,-52.2388 59.5001,-62.2388 66.5001,-62.2387"/>
</g>
<g class="m-node">
<title>p0x1da4a88</title>
<polygon points="269,-173 235.8992,-155 269,-137 302.1008,-155 269,-173"/>
<text text-anchor="middle" x="269" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">cond</text>
</g>
<g class="m-node m-flat">
<title>p0x1da4b70</title>
<polygon points="188,-52 134,-52 134,-48 130,-48 130,-44 134,-44 134,-24 130,-24 130,-20 134,-20 134,-16 188,-16 188,-52"/>
<polyline points="134,-48 138,-48 138,-44 134,-44 "/>
<polyline points="134,-24 138,-24 138,-20 134,-20 "/>
<text text-anchor="middle" x="161" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;0</text>
</g>
<g class="m-edge">
<title>p0x1da4a88&#45;&gt;p0x1da4b70</title>
<path stroke-dasharray="5,2" d="M257.8489,-142.5066C240.4613,-123.0261 206.5317,-85.0123 183.8111,-59.5569"/>
<polygon points="186.4206,-57.2243 177.1504,-52.0945 181.1982,-61.8856 186.4206,-57.2243"/>
<text text-anchor="middle" x="221.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">0</text>
</g>
<g class="m-node m-flat">
<title>p0x1da4c58</title>
<polygon points="260,-52 206,-52 206,-48 202,-48 202,-44 206,-44 206,-24 202,-24 202,-20 206,-20 206,-16 260,-16 260,-52"/>
<polyline points="206,-48 210,-48 210,-44 206,-44 "/>
<polyline points="206,-24 210,-24 210,-20 206,-20 "/>
<text text-anchor="middle" x="233" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;1</text>
</g>
<g class="m-edge">
<title>p0x1da4a88&#45;&gt;p0x1da4c58</title>
<path stroke-dasharray="5,2" d="M264.2936,-139.1814C258.4568,-119.5631 248.4064,-85.7825 241.2713,-61.8008"/>
<polygon points="244.6191,-60.7793 238.4127,-52.1927 237.9098,-62.7756 244.6191,-60.7793"/>
<text text-anchor="middle" x="255.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">1</text>
</g>
<g class="m-node m-flat">
<title>p0x1da4d40</title>
<polygon points="332,-52 278,-52 278,-48 274,-48 274,-44 278,-44 278,-24 274,-24 274,-20 278,-20 278,-16 332,-16 332,-52"/>
<polyline points="278,-48 282,-48 282,-44 278,-44 "/>
<polyline points="278,-24 282,-24 282,-20 278,-20 "/>
<text text-anchor="middle" x="305" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;2</text>
</g>
<g class="m-edge">
<title>p0x1da4a88&#45;&gt;p0x1da4d40</title>
<path stroke-dasharray="5,2" d="M273.7064,-139.1814C279.5432,-119.5631 289.5936,-85.7825 296.7287,-61.8008"/>
<polygon points="300.0902,-62.7756 299.5873,-52.1927 293.3809,-60.7793 300.0902,-62.7756"/>
<text text-anchor="middle" x="291.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">2</text>
</g>
<g class="m-node m-flat">
<title>p0x1da4e28</title>
<polygon points="404,-52 350,-52 350,-48 346,-48 346,-44 350,-44 350,-24 346,-24 346,-20 350,-20 350,-16 404,-16 404,-52"/>
<polyline points="350,-48 354,-48 354,-44 350,-44 "/>
<polyline points="350,-24 354,-24 354,-20 350,-20 "/>
<text text-anchor="middle" x="377" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;3</text>
</g>
<g class="m-edge">
<title>p0x1da4a88&#45;&gt;p0x1da4e28</title>
<path stroke-dasharray="5,2" d="M280.1511,-142.5066C297.5387,-123.0261 331.4683,-85.0123 354.1889,-59.5569"/>
<polygon points="356.8018,-61.8856 360.8496,-52.0945 351.5794,-57.2243 356.8018,-61.8856"/>
<text text-anchor="middle" x="329.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">3</text>
</g>
<g class="m-node">
<title>p0x1da4600</title>
<polygon points="563,-173 529.8992,-155 563,-137 596.1008,-155 563,-173"/>
<text text-anchor="middle" x="563" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">cond</text>
</g>
<g class="m-node m-flat">
<title>p0x1da46e8</title>
<polygon points="482,-52 428,-52 428,-48 424,-48 424,-44 428,-44 428,-24 424,-24 424,-20 428,-20 428,-16 482,-16 482,-52"/>
<polyline points="428,-48 432,-48 432,-44 428,-44 "/>
<polyline points="428,-24 432,-24 432,-20 428,-20 "/>
<text text-anchor="middle" x="455" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;0</text>
</g>
<g class="m-edge">
<title>p0x1da4600&#45;&gt;p0x1da46e8</title>
<path stroke-dasharray="5,2" d="M551.8489,-142.5066C534.4613,-123.0261 500.5317,-85.0123 477.8111,-59.5569"/>
<polygon points="480.4206,-57.2243 471.1504,-52.0945 475.1982,-61.8856 480.4206,-57.2243"/>
<text text-anchor="middle" x="515.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">0</text>
</g>
<g class="m-node m-flat">
<title>p0x1da47d0</title>
<polygon points="554,-52 500,-52 500,-48 496,-48 496,-44 500,-44 500,-24 496,-24 496,-20 500,-20 500,-16 554,-16 554,-52"/>
<polyline points="500,-48 504,-48 504,-44 500,-44 "/>
<polyline points="500,-24 504,-24 504,-20 500,-20 "/>
<text text-anchor="middle" x="527" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;1</text>
</g>
<g class="m-edge">
<title>p0x1da4600&#45;&gt;p0x1da47d0</title>
<path stroke-dasharray="5,2" d="M558.2936,-139.1814C552.4568,-119.5631 542.4064,-85.7825 535.2713,-61.8008"/>
<polygon points="538.6191,-60.7793 532.4127,-52.1927 531.9098,-62.7756 538.6191,-60.7793"/>
<text text-anchor="middle" x="549.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">1</text>
</g>
<g class="m-node m-flat">
<title>p0x1da48b8</title>
<polygon points="626,-52 572,-52 572,-48 568,-48 568,-44 572,-44 572,-24 568,-24 568,-20 572,-20 572,-16 626,-16 626,-52"/>
<polyline points="572,-48 576,-48 576,-44 572,-44 "/>
<polyline points="572,-24 576,-24 576,-20 572,-20 "/>
<text text-anchor="middle" x="599" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;2</text>
</g>
<g class="m-edge">
<title>p0x1da4600&#45;&gt;p0x1da48b8</title>
<path stroke-dasharray="5,2" d="M567.7064,-139.1814C573.5432,-119.5631 583.5936,-85.7825 590.7287,-61.8008"/>
<polygon points="594.0902,-62.7756 593.5873,-52.1927 587.3809,-60.7793 594.0902,-62.7756"/>
<text text-anchor="middle" x="585.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">2</text>
</g>
<g class="m-node m-flat">
<title>p0x1da49a0</title>
<polygon points="698,-52 644,-52 644,-48 640,-48 640,-44 644,-44 644,-24 640,-24 640,-20 644,-20 644,-16 698,-16 698,-52"/>
<polyline points="644,-48 648,-48 648,-44 644,-44 "/>
<polyline points="644,-24 648,-24 648,-20 644,-20 "/>
<text text-anchor="middle" x="671" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;3</text>
</g>
<g class="m-edge">
<title>p0x1da4600&#45;&gt;p0x1da49a0</title>
<path stroke-dasharray="5,2" d="M574.1511,-142.5066C591.5387,-123.0261 625.4683,-85.0123 648.1889,-59.5569"/>
<polygon points="650.8018,-61.8856 654.8496,-52.0945 645.5794,-57.2243 650.8018,-61.8856"/>
<text text-anchor="middle" x="623.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">3</text>
</g>
</g>
</svg>
</div><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input buffer_2<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input buffer_2<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input buffer_2<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input <span class="nv">value</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">2</span>, pipe <span class="m">3</span>: input buffer_2<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">6</span></pre><p>The output of pipelines <code>pl_1</code> and <code>pl_2</code> can be different from run to run because their second pipes are both parallel types. Due to the task dependency between <code>pipeline_1</code> and <code>pipeline_2</code>, the output of <code>pl_1</code> precedes the output of <code>pl_2</code>.</p></section><section id="DefineMultipleTaskParallelPipelines"><h3><a href="#DefineMultipleTaskParallelPipelines">Example 3: Define Multiple Parallel Pipelines</a></h3><p>This example creates two independent pipelines that run in parallel on different data sets.</p><pre class="m-code"><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="n">taskflow</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">4</span><span class="o">:</span><span class="w"> </span><span class="c1">// define the maximum parallelism of the pipeline</span>
<span class="w"> </span><span class="mi">5</span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">6</span><span class="o">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">7</span><span class="o">:</span><span class="w"> </span><span class="c1">// custom data storage</span>
<span class="w"> </span><span class="mi">8</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="mi">9</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">;</span><span class="w"></span>
<span class="mi">10</span><span class="o">:</span><span class="w"> </span>
<span class="mi">11</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_1 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">12</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">13</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_1</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">14</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">15</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 5 scheduling tokens</span>
<span class="mi">16</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">17</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">18</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">19</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">20</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">21</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 1, pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">22</span><span class="o">:</span><span class="w">       </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="mi">23</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">24</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">25</span><span class="o">:</span><span class="w"></span>
<span class="mi">26</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">27</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">28</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 1: input buffer_1[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">29</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">30</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">31</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">32</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">33</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">34</span><span class="o">:</span><span class="w"></span>
<span class="mi">35</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_1</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">36</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">37</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 1, pipe 2: input buffer_1[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">38</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">39</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">40</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="mi">41</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_1</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="mi">42</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">43</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">44</span><span class="o">:</span><span class="w">  </span>
<span class="mi">45</span><span class="o">:</span><span class="w"> </span><span class="c1">// the pipeline_2 consists of three pipes (serial-parallel-serial)</span>
<span class="mi">46</span><span class="o">:</span><span class="w"> </span><span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="mi">47</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="n">pl_2</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="mi">48</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="mi">49</span><span class="o">:</span><span class="w">     </span><span class="c1">// generate only 2 scheduling tokens</span>
<span class="mi">50</span><span class="o">:</span><span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">51</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="mi">52</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">53</span><span class="o">:</span><span class="w">     </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="mi">54</span><span class="o">:</span><span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">55</span><span class="o">:</span><span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipeline 2, pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="mi">56</span><span class="o">:</span><span class="w">       </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pipeline&quot;</span><span class="p">;</span><span class="w"></span>
<span class="mi">57</span><span class="o">:</span><span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="mi">58</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">59</span><span class="o">:</span><span class="w"></span>
<span class="mi">60</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">61</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">62</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 1: input buffer_2[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">63</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">64</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">65</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by concatenating &quot;_&quot;</span>
<span class="mi">66</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()];</span><span class="w"></span>
<span class="mi">67</span><span class="o">:</span><span class="w">   </span><span class="p">}},</span><span class="w"></span>
<span class="mi">68</span><span class="o">:</span><span class="w"></span>
<span class="mi">69</span><span class="o">:</span><span class="w">   </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer_2</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="mi">70</span><span class="o">:</span><span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="mi">71</span><span class="o">:</span><span class="w">       </span><span class="s">&quot;pipeline 2, pipe 2: input buffer_2[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="mi">72</span><span class="o">:</span><span class="w">       </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="mi">73</span><span class="o">:</span><span class="w">     </span><span class="p">);</span><span class="w"></span>
<span class="mi">74</span><span class="o">:</span><span class="w">     </span><span class="c1">// propagate the previous result to this pipe by concatenating &quot;2&quot;</span>
<span class="mi">75</span><span class="o">:</span><span class="w">     </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer_2</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()];</span><span class="w"></span>
<span class="mi">76</span><span class="o">:</span><span class="w">   </span><span class="p">}}</span><span class="w"></span>
<span class="mi">77</span><span class="o">:</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="mi">78</span><span class="o">:</span><span class="w"></span>
<span class="mi">79</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_1</span><span class="p">)</span><span class="w"></span>
<span class="mi">80</span><span class="o">:</span><span class="w">                               </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">81</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl_2</span><span class="p">)</span><span class="w"></span>
<span class="mi">82</span><span class="o">:</span><span class="w">                               </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline_2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">83</span><span class="o">:</span><span class="w"> </span><span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;initial&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="mi">84</span><span class="o">:</span><span class="w">                               </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;initial&quot;</span><span class="p">);</span><span class="w"></span>
<span class="mi">85</span><span class="o">:</span><span class="w"></span>
<span class="mi">86</span><span class="o">:</span><span class="w"> </span><span class="n">initial</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline_1</span><span class="p">,</span><span class="w"> </span><span class="n">pipeline_2</span><span class="p">);</span><span class="w"></span>
<span class="mi">87</span><span class="o">:</span><span class="w">  </span>
<span class="mi">88</span><span class="o">:</span><span class="w"> </span><span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>Debrief:</p><ul><li>Line 8 defines the data storage (<code>num_lines</code> integers) for pipeline <code>pl_1</code></li><li>Line 9 defines the data storage (<code>num_lines</code> integers) for pipeline <code>pl_2</code></li><li>Lines 14-24 define the first serial pipe in <code>pl_1</code></li><li>Lines 26-33 define the second parallel pipe in <code>pl_1</code></li><li>Lines 35-42 define the third serial pipe in <code>pl_1</code></li><li>Lines 48-58 define the first serial pipe in <code>pl_2</code></li><li>Lines 60-67 define the second parallel pipe in <code>pl_2</code></li><li>Lines 69-76 define the third serial pipe in <code>pl_2</code></li><li>Lines 79-82 define the pipeline graphs using composition</li><li>Lines 83-84 define a static task.</li><li>Line 86 defines the task dependency</li><li>Line 88 runs the taskflow</li></ul><p>The taskflow graph of this pipeline example is illustrated as follows:</p><div class="m-graph"><svg style="width: 83.300rem; height: 21.600rem;" viewBox="0.00 0.00 833.00 216.00">
<g transform="scale(1 1) rotate(0) translate(4 212)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster_p0x7ffe35bde158</title>
<polygon points="8,-8 8,-200 229,-200 229,-8 8,-8"/>
<text text-anchor="middle" x="118.5" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">Taskflow</text>
</g>
<g class="m-cluster">
<title>cluster_p0x7ffe35bddd80</title>
<polygon points="237,-8 237,-200 523,-200 523,-8 237,-8"/>
<text text-anchor="middle" x="380" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">m2</text>
</g>
<g class="m-cluster">
<title>cluster_p0x7ffe35bdde20</title>
<polygon points="531,-8 531,-200 817,-200 817,-8 531,-8"/>
<text text-anchor="middle" x="674" y="-188" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">m1</text>
</g>
<g class="m-node m-flat">
<title>p0x131af10</title>
<polygon points="109.5,-52 20.5,-52 16.5,-48 16.5,-16 105.5,-16 109.5,-20 109.5,-52"/>
<polyline points="105.5,-48 16.5,-48 "/>
<polyline points="105.5,-48 105.5,-16 "/>
<polyline points="105.5,-48 109.5,-52 "/>
<text text-anchor="middle" x="63" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipeline_1 [m1]</text>
</g>
<g class="m-node m-flat">
<title>p0x131aff8</title>
<polygon points="220.5,-52 131.5,-52 127.5,-48 127.5,-16 216.5,-16 220.5,-20 220.5,-52"/>
<polyline points="216.5,-48 127.5,-48 "/>
<polyline points="216.5,-48 216.5,-16 "/>
<polyline points="216.5,-48 220.5,-52 "/>
<text text-anchor="middle" x="174" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">pipeline_2 [m2]</text>
</g>
<g class="m-node m-flat">
<title>p0x131b0e0</title>
<ellipse cx="119" cy="-155" rx="27" ry="18"/>
<text text-anchor="middle" x="119" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">initial</text>
</g>
<g class="m-edge">
<title>p0x131b0e0&#45;&gt;p0x131af10</title>
<path d="M110.9766,-137.6637C101.7675,-117.7655 86.5429,-84.8695 75.7152,-61.4739"/>
<polygon points="78.7508,-59.6996 71.3743,-52.0945 72.3981,-62.6397 78.7508,-59.6996"/>
</g>
<g class="m-edge">
<title>p0x131b0e0&#45;&gt;p0x131aff8</title>
<path d="M126.8802,-137.6637C135.9248,-117.7655 150.8775,-84.8695 161.5119,-61.4739"/>
<polygon points="164.8234,-62.6465 165.7752,-52.0945 158.4509,-59.7498 164.8234,-62.6465"/>
</g>
<g class="m-node">
<title>p0x131aa88</title>
<polygon points="380,-173 346.8992,-155 380,-137 413.1008,-155 380,-173"/>
<text text-anchor="middle" x="380" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">cond</text>
</g>
<g class="m-node m-flat">
<title>p0x131ab70</title>
<polygon points="299,-52 245,-52 245,-48 241,-48 241,-44 245,-44 245,-24 241,-24 241,-20 245,-20 245,-16 299,-16 299,-52"/>
<polyline points="245,-48 249,-48 249,-44 245,-44 "/>
<polyline points="245,-24 249,-24 249,-20 245,-20 "/>
<text text-anchor="middle" x="272" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;0</text>
</g>
<g class="m-edge">
<title>p0x131aa88&#45;&gt;p0x131ab70</title>
<path stroke-dasharray="5,2" d="M368.8489,-142.5066C351.4613,-123.0261 317.5317,-85.0123 294.8111,-59.5569"/>
<polygon points="297.4206,-57.2243 288.1504,-52.0945 292.1982,-61.8856 297.4206,-57.2243"/>
<text text-anchor="middle" x="332.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">0</text>
</g>
<g class="m-node m-flat">
<title>p0x131ac58</title>
<polygon points="371,-52 317,-52 317,-48 313,-48 313,-44 317,-44 317,-24 313,-24 313,-20 317,-20 317,-16 371,-16 371,-52"/>
<polyline points="317,-48 321,-48 321,-44 317,-44 "/>
<polyline points="317,-24 321,-24 321,-20 317,-20 "/>
<text text-anchor="middle" x="344" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;1</text>
</g>
<g class="m-edge">
<title>p0x131aa88&#45;&gt;p0x131ac58</title>
<path stroke-dasharray="5,2" d="M375.2936,-139.1814C369.4568,-119.5631 359.4064,-85.7825 352.2713,-61.8008"/>
<polygon points="355.6191,-60.7793 349.4127,-52.1927 348.9098,-62.7756 355.6191,-60.7793"/>
<text text-anchor="middle" x="366.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">1</text>
</g>
<g class="m-node m-flat">
<title>p0x131ad40</title>
<polygon points="443,-52 389,-52 389,-48 385,-48 385,-44 389,-44 389,-24 385,-24 385,-20 389,-20 389,-16 443,-16 443,-52"/>
<polyline points="389,-48 393,-48 393,-44 389,-44 "/>
<polyline points="389,-24 393,-24 393,-20 389,-20 "/>
<text text-anchor="middle" x="416" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;2</text>
</g>
<g class="m-edge">
<title>p0x131aa88&#45;&gt;p0x131ad40</title>
<path stroke-dasharray="5,2" d="M384.7064,-139.1814C390.5432,-119.5631 400.5936,-85.7825 407.7287,-61.8008"/>
<polygon points="411.0902,-62.7756 410.5873,-52.1927 404.3809,-60.7793 411.0902,-62.7756"/>
<text text-anchor="middle" x="402.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">2</text>
</g>
<g class="m-node m-flat">
<title>p0x131ae28</title>
<polygon points="515,-52 461,-52 461,-48 457,-48 457,-44 461,-44 461,-24 457,-24 457,-20 461,-20 461,-16 515,-16 515,-52"/>
<polyline points="461,-48 465,-48 465,-44 461,-44 "/>
<polyline points="461,-24 465,-24 465,-20 461,-20 "/>
<text text-anchor="middle" x="488" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;3</text>
</g>
<g class="m-edge">
<title>p0x131aa88&#45;&gt;p0x131ae28</title>
<path stroke-dasharray="5,2" d="M391.1511,-142.5066C408.5387,-123.0261 442.4683,-85.0123 465.1889,-59.5569"/>
<polygon points="467.8018,-61.8856 471.8496,-52.0945 462.5794,-57.2243 467.8018,-61.8856"/>
<text text-anchor="middle" x="440.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">3</text>
</g>
<g class="m-node">
<title>p0x131a600</title>
<polygon points="674,-173 640.8992,-155 674,-137 707.1008,-155 674,-173"/>
<text text-anchor="middle" x="674" y="-152.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">cond</text>
</g>
<g class="m-node m-flat">
<title>p0x131a6e8</title>
<polygon points="593,-52 539,-52 539,-48 535,-48 535,-44 539,-44 539,-24 535,-24 535,-20 539,-20 539,-16 593,-16 593,-52"/>
<polyline points="539,-48 543,-48 543,-44 539,-44 "/>
<polyline points="539,-24 543,-24 543,-20 539,-20 "/>
<text text-anchor="middle" x="566" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;0</text>
</g>
<g class="m-edge">
<title>p0x131a600&#45;&gt;p0x131a6e8</title>
<path stroke-dasharray="5,2" d="M662.8489,-142.5066C645.4613,-123.0261 611.5317,-85.0123 588.8111,-59.5569"/>
<polygon points="591.4206,-57.2243 582.1504,-52.0945 586.1982,-61.8856 591.4206,-57.2243"/>
<text text-anchor="middle" x="626.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">0</text>
</g>
<g class="m-node m-flat">
<title>p0x131a7d0</title>
<polygon points="665,-52 611,-52 611,-48 607,-48 607,-44 611,-44 611,-24 607,-24 607,-20 611,-20 611,-16 665,-16 665,-52"/>
<polyline points="611,-48 615,-48 615,-44 611,-44 "/>
<polyline points="611,-24 615,-24 615,-20 611,-20 "/>
<text text-anchor="middle" x="638" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;1</text>
</g>
<g class="m-edge">
<title>p0x131a600&#45;&gt;p0x131a7d0</title>
<path stroke-dasharray="5,2" d="M669.2936,-139.1814C663.4568,-119.5631 653.4064,-85.7825 646.2713,-61.8008"/>
<polygon points="649.6191,-60.7793 643.4127,-52.1927 642.9098,-62.7756 649.6191,-60.7793"/>
<text text-anchor="middle" x="660.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">1</text>
</g>
<g class="m-node m-flat">
<title>p0x131a8b8</title>
<polygon points="737,-52 683,-52 683,-48 679,-48 679,-44 683,-44 683,-24 679,-24 679,-20 683,-20 683,-16 737,-16 737,-52"/>
<polyline points="683,-48 687,-48 687,-44 683,-44 "/>
<polyline points="683,-24 687,-24 687,-20 683,-20 "/>
<text text-anchor="middle" x="710" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;2</text>
</g>
<g class="m-edge">
<title>p0x131a600&#45;&gt;p0x131a8b8</title>
<path stroke-dasharray="5,2" d="M678.7064,-139.1814C684.5432,-119.5631 694.5936,-85.7825 701.7287,-61.8008"/>
<polygon points="705.0902,-62.7756 704.5873,-52.1927 698.3809,-60.7793 705.0902,-62.7756"/>
<text text-anchor="middle" x="696.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">2</text>
</g>
<g class="m-node m-flat">
<title>p0x131a9a0</title>
<polygon points="809,-52 755,-52 755,-48 751,-48 751,-44 755,-44 755,-24 751,-24 751,-20 755,-20 755,-16 809,-16 809,-52"/>
<polyline points="755,-48 759,-48 759,-44 755,-44 "/>
<polyline points="755,-24 759,-24 759,-20 755,-20 "/>
<text text-anchor="middle" x="782" y="-31.5" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">rt&#45;3</text>
</g>
<g class="m-edge">
<title>p0x131a600&#45;&gt;p0x131a9a0</title>
<path stroke-dasharray="5,2" d="M685.1511,-142.5066C702.5387,-123.0261 736.4683,-85.0123 759.1889,-59.5569"/>
<polygon points="761.8018,-61.8856 765.8496,-52.0945 756.5794,-57.2243 761.8018,-61.8856"/>
<text text-anchor="middle" x="734.5" y="-92" font-family="Helvetica,sans-Serif" font-size="10.00" fill="#000000">3</text>
</g>
</g>
</svg>
</div><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">initial
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input buffer_2<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">1</span>, pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input buffer_2<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input buffer_2<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input buffer_2<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input buffer_2<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">1</span>: input buffer_2<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">2</span>, pipe <span class="m">2</span>: input buffer_2<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipeline <span class="m">1</span>, pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span></pre><p>Because pipeline <code>pl_1</code> and pipeline <code>pl_2</code> are running in parallel, their outputs may interleave.</p></section></section><section id="ResetPipeline"><h2><a href="#ResetPipeline">Reset a Pipeline</a></h2><p>Our pipeline scheduling framework keeps a <em>stateful</em> number of scheduled tokens at each submitted run. You can reset the pipeline to the initial state using <a href="classtf_1_1Pipeline.html#a311d874b98de6f0def8a7d869e8d15bd" class="m-doc">tf::<wbr />Pipeline::<wbr />reset()</a>, where the number of scheduled tokens will start from zero in the next run. Borrowed from <a href="TaskParallelPipeline.html#IterateAPipeline" class="m-doc">Example 1: Iterate a Pipeline</a>, the program below resets the pipeline at the second iteration (inside the condition task) so the scheduling token will start from zero in the next run.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span><span class="w"> </span><span class="nf">taskflow</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Executor</span><span class="w"> </span><span class="n">executor</span><span class="p">;</span><span class="w"></span>

<span class="c1">// define the maximum parallelism of the pipeline</span>
<span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>

<span class="c1">// custom data storage</span>
<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span><span class="w"></span>

<span class="c1">// the pipeline consists of three pipes (serial-parallel-serial)</span>
<span class="c1">// and up to four concurrent scheduling tokens</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Pipeline</span><span class="w"> </span><span class="nf">pl</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// generate only 5 scheduling tokens</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">pf</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// save the result of this pipe into the buffer</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;pipe 0: input token = %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">token</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}},</span><span class="w"></span>

<span class="w">  </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">PARALLEL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;pipe 1: input buffer_1[%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}},</span><span class="w"></span>

<span class="w">  </span><span class="n">tf</span><span class="o">::</span><span class="n">Pipe</span><span class="p">{</span><span class="n">tf</span><span class="o">::</span><span class="n">PipeType</span><span class="o">::</span><span class="n">SERIAL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">](</span><span class="n">tf</span><span class="o">::</span><span class="n">Pipeflow</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pf</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;pipe 2: input buffer[%zu][%zu] = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// propagate the previous result to this pipe by adding one</span>
<span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">pf</span><span class="p">.</span><span class="n">line</span><span class="p">()]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}}</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
<span class="w"> </span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">conditional</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](){</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pl</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Rerun the pipeline</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;conditional&quot;</span><span class="p">);</span><span class="w"></span>

<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">composed_of</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">initial</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;initial&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="w">                            </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;initial&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span><span class="w"> </span><span class="n">stop</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;stop&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="w">                            </span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span><span class="w"></span>

<span class="n">initial</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">);</span><span class="w"></span>
<span class="n">pipeline</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">conditional</span><span class="p">);</span><span class="w"></span>
<span class="n">conditional</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span>
<span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span><span class="w"></span></pre><p>The following snippet shows one of the possible outputs:</p><pre class="m-code">initial
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
Rerun the pipeline
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">2</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">3</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">0</span>: input <span class="nv">token</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">1</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">4</span>
pipe <span class="m">2</span>: input buffer_1<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">5</span>
stop</pre><p>The output can be different from run to run, since the second pipe is a parallel type. At the second iteration from the condition task, we reset the pipeline so the token identifier starts from <code>0</code> rather than <code>5</code>.</p></section><section id="TaskParallelPipelineLearnMore"><h2><a href="#TaskParallelPipelineLearnMore">Learn More about Taskflow Pipeline</a></h2><p>Visit the following pages to learn more about pipeline:</p><ul><li><a href="TaskParallelScalablePipeline.html" class="m-doc">Task-parallel Scalable Pipeline</a></li><li><a href="DataParallelPipeline.html" class="m-doc">Data-parallel Pipeline</a></li><li><a href="TextProcessingPipeline.html" class="m-doc">Text Processing Pipeline</a></li><li><a href="GraphProcessingPipeline.html" class="m-doc">Graph Processing Pipeline</a></li><li><a href="TaskflowProcessingPipeline.html" class="m-doc">Taskflow Processing Pipeline</a></li></ul></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim"></span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim"></span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v2.js"></script>
<script src="searchdata-v2.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Taskflow handbook is part of the <a href="https://taskflow.github.io">Taskflow project</a>, copyright  <a href="https://tsung-wei-huang.github.io/">Dr. Tsung-Wei Huang</a>, 2018&ndash;2023.<br />Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.14 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
