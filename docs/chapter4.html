<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cookbook &raquo; Conditional Tasking | Taskflow QuickStart</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <span id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">
        <a href="https://taskflow.github.io"><img src="taskflow_logo.png" alt="" />Taskflow</a> <span class="m-breadcrumb">|</span> <a href="index.html" class="m-thin">QuickStart</a>
      </span>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Handbook</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="Cookbook.html">Cookbook</a> &raquo;</span>
          Conditional Tasking
        </h1>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li><a href="#C4_CreateAConditionTask">Create a Condition Task</a></li>
            <li>
              <a href="#C4_TaskSchedulingPolicy">Understand our Task-level Scheduling</a>
              <ul>
                <li><a href="#TaskLevelSchedulingExample">Example</a></li>
              </ul>
            </li>
            <li><a href="#C4_AvoidCommonPitfalls">Avoid Common Pitfalls</a></li>
          </ul>
        </div>
<p>Parallel workloads often require making control-flow decisions across dependent tasks. Taskflow supports an very efficient interface of conditional tasking for users to implement general control flow such as dynamic flow, cycles, and conditionals that are otherwise difficult to do with existing frameworks.</p><section id="C4_CreateAConditionTask"><h2><a href="#C4_CreateAConditionTask">Create a Condition Task</a></h2><p>A condition task evalutes a set of instructions and returns an integer index of the next immediate successor to execute. The index is defined with respect to the order of its successor construction.</p><pre class="m-code"> <span class="mi">1</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span> <span class="n">taskflow</span><span class="p">;</span>
 <span class="mi">2</span><span class="o">:</span> 
 <span class="mi">3</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">init</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">);</span>
 <span class="mi">4</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;stop&quot;</span><span class="p">);</span>
 <span class="mi">5</span><span class="o">:</span>
 <span class="mi">6</span><span class="o">:</span> <span class="c1">// creates a condition task that returns 0 or 1</span>
 <span class="mi">7</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span>
 <span class="mi">8</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;flipping a coin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
 <span class="mi">9</span><span class="o">:</span>  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
<span class="mi">10</span><span class="o">:</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond&quot;</span><span class="p">);</span>
<span class="mi">11</span><span class="o">:</span>
<span class="mi">12</span><span class="o">:</span> <span class="c1">// creates a feedback loop {0: cond, 1: stop}</span>
<span class="mi">13</span><span class="o">:</span> <span class="n">init</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">);</span>
<span class="mi">14</span><span class="o">:</span> <span class="n">cond</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">stop</span><span class="p">);</span>  <span class="c1">// returns 0 to &#39;cond&#39; or 1 to &#39;stop&#39;</span>
<span class="mi">15</span><span class="o">:</span>
<span class="mi">16</span><span class="o">:</span> <span class="n">executor</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">taskflow</span><span class="p">).</span><span class="n">wait</span><span class="p">();</span></pre><div class="m-graph"><svg style="width: 19.688rem; height: 6.000rem;" viewBox="0.00 0.00 315.47 96.00">
<g transform="scale(1 1) rotate(0) translate(4 92)">
<title>Taskflow</title>
<g class="m-node">
<title>cond</title>
<polygon points="143,-52 91,-26 143,0 195,-26 143,-52"/>
<text text-anchor="middle" x="143" y="-22.2">cond</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;cond</title>
<path stroke-dasharray="5,2" d="M130.8,-45.91C127.86,-58.25 131.93,-70 143,-70 150.96,-70 155.3,-63.93 156.02,-55.94"/>
<polygon points="159.5,-55.59 155.2,-45.91 152.52,-56.16 159.5,-55.59"/>
<text text-anchor="middle" x="143" y="-75.2">0</text>
</g>
<g class="m-node m-flat">
<title>stop</title>
<ellipse cx="274.23" cy="-26" rx="33.47" ry="18.27"/>
<text text-anchor="middle" x="274.23" y="-22.2">stop</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;stop</title>
<path stroke-dasharray="5,2" d="M195.08,-26C206.85,-26 219.26,-26 230.63,-26"/>
<polygon points="230.73,-29.5 240.73,-26 230.73,-22.5 230.73,-29.5"/>
<text text-anchor="middle" x="218" y="-31.2">1</text>
</g>
<g class="m-node m-flat">
<title>init</title>
<ellipse cx="27" cy="-26" rx="27" ry="18.27"/>
<text text-anchor="middle" x="27" y="-22.2">init</text>
</g>
<g class="m-edge">
<title>init&#45;&gt;cond</title>
<path d="M54.15,-26C62.17,-26 71.35,-26 80.68,-26"/>
<polygon points="80.82,-29.5 90.82,-26 80.82,-22.5 80.82,-29.5"/>
</g>
</g>
</svg>
</div><p>The example above implements a simple yet commonly used feedback loop through a condition task (line 7-10) that returns a random binary value. If the return value from <code>cond</code> is <code>0</code>, it loops back to itself, or otherwise to <code>stop</code>. Our conditional tasking interface is very neat and expressive. A complex flow control often just takes a few lines of code to implement. The code below creates another taskflow with three condition tasks.</p><pre class="m-code"><span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span> <span class="n">taskflow</span><span class="p">;</span>

<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">A</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">B</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">C</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">D</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">E</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">F</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;F&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">G</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;G&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">H</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;H&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">I</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">K</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;K&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">L</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">M</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond_1</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_1&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond_2</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_2&quot;</span><span class="p">);</span>
<span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">cond_3</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2</span><span class="p">;</span> <span class="p">}).</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;cond_3&quot;</span><span class="p">);</span>

<span class="n">A</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">F</span><span class="p">);</span>
<span class="n">B</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
<span class="n">C</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">D</span><span class="p">);</span>
<span class="n">D</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_1</span><span class="p">);</span>
<span class="n">E</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">K</span><span class="p">);</span>
<span class="n">F</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_2</span><span class="p">);</span>
<span class="n">H</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">I</span><span class="p">);</span>
<span class="n">I</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_3</span><span class="p">);</span>
<span class="n">L</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>

<span class="n">cond_1</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">E</span><span class="p">);</span>       <span class="c1">// return 0 to &#39;B&#39; or 1 to &#39;E&#39;</span>
<span class="n">cond_2</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">H</span><span class="p">);</span>       <span class="c1">// return 0 to &#39;G&#39; or 1 to &#39;H&#39;</span>
<span class="n">cond_3</span><span class="p">.</span><span class="n">precede</span><span class="p">(</span><span class="n">cond_3</span><span class="p">,</span> <span class="n">L</span><span class="p">);</span>  <span class="c1">// return 0 to &#39;cond_3&#39; or 1 to &#39;L&#39;</span>

<span class="n">taskflow</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">);</span></pre><p>The above code creates three condition tasks: (1) a condition task <code>cond_1</code> that loops back to <code>B</code> on returning <code>0</code>, or proceeds to <code>E</code> on returning <code>1</code>, (2) a condition task <code>cond_2</code> that goes to <code>G</code> on returning <code>0</code>, or <code>H</code> on returning <code>1</code>, (3) a condition task <code>cond_3</code> that loops back to itself on returning <code>0</code>, or proceeds to <code>L</code> on returning <code>1</code></p><div class="m-graph"><svg style="width: 61.500rem; height: 12.688rem;" viewBox="0.00 0.00 984.00 203.38">
<g transform="scale(1 1) rotate(0) translate(4 199.38)">
<title>Taskflow</title>
<g class="m-node m-flat">
<title>p0x7fecbdc02830</title>
<ellipse cx="27" cy="-104" rx="27" ry="18.27"/>
<text text-anchor="middle" x="27" y="-100.2">A</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02940</title>
<ellipse cx="118" cy="-132" rx="27" ry="18.27"/>
<text text-anchor="middle" x="118" y="-128.2">B</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02830&#45;&gt;p0x7fecbdc02940</title>
<path d="M51.85,-111.5C61.53,-114.55 72.88,-118.12 83.37,-121.42"/>
<polygon points="82.49,-124.81 93.08,-124.48 84.6,-118.14 82.49,-124.81"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02d80</title>
<ellipse cx="118" cy="-77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="118" y="-73.2">F</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02830&#45;&gt;p0x7fecbdc02d80</title>
<path d="M51.85,-96.76C61.53,-93.83 72.88,-90.39 83.37,-87.2"/>
<polygon points="84.53,-90.51 93.08,-84.26 82.5,-83.81 84.53,-90.51"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02a50</title>
<ellipse cx="252" cy="-177" rx="27" ry="18.27"/>
<text text-anchor="middle" x="252" y="-173.2">C</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02940&#45;&gt;p0x7fecbdc02a50</title>
<path d="M142.6,-140.05C163.62,-147.21 194.6,-157.77 218.06,-165.77"/>
<polygon points="217.01,-169.11 227.61,-169.02 219.27,-162.48 217.01,-169.11"/>
</g>
<g class="m-node">
<title>p0x7fecbdc03600</title>
<polygon points="252,-103 182,-77 252,-51 322,-77 252,-103"/>
<text text-anchor="middle" x="252" y="-73.2">cond_2</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02d80&#45;&gt;p0x7fecbdc03600</title>
<path d="M145.08,-77C153.05,-77 162.27,-77 171.88,-77"/>
<polygon points="171.99,-80.5 181.99,-77 171.99,-73.5 171.99,-80.5"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02b60</title>
<ellipse cx="395" cy="-177" rx="27" ry="18.27"/>
<text text-anchor="middle" x="395" y="-173.2">D</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02a50&#45;&gt;p0x7fecbdc02b60</title>
<path d="M279.19,-177C301.35,-177 333.33,-177 357.92,-177"/>
<polygon points="357.95,-180.5 367.95,-177 357.95,-173.5 357.95,-180.5"/>
</g>
<g class="m-node">
<title>p0x7fecbdc034f0</title>
<polygon points="529,-174 459,-148 529,-122 599,-148 529,-174"/>
<text text-anchor="middle" x="529" y="-144.2">cond_1</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02b60&#45;&gt;p0x7fecbdc034f0</title>
<path d="M420.83,-171.55C436.02,-168.21 456.06,-163.8 474.7,-159.71"/>
<polygon points="475.56,-163.11 484.57,-157.54 474.05,-156.27 475.56,-163.11"/>
</g>
<g class="m-edge">
<title>p0x7fecbdc034f0&#45;&gt;p0x7fecbdc02940</title>
<path stroke-dasharray="5,2" d="M465.5,-145.55C378.86,-142.17 225.08,-136.15 155.27,-133.42"/>
<polygon points="155.34,-129.92 145.21,-133.03 155.06,-136.91 155.34,-129.92"/>
<text text-anchor="middle" x="345" y="-146.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02c70</title>
<ellipse cx="715" cy="-148" rx="27" ry="18.27"/>
<text text-anchor="middle" x="715" y="-144.2">E</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc034f0&#45;&gt;p0x7fecbdc02c70</title>
<path stroke-dasharray="5,2" d="M599.04,-148C625.8,-148 655.33,-148 677.76,-148"/>
<polygon points="677.84,-151.5 687.84,-148 677.84,-144.5 677.84,-151.5"/>
<text text-anchor="middle" x="622" y="-153.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc031c0</title>
<ellipse cx="858" cy="-148" rx="27" ry="18.27"/>
<text text-anchor="middle" x="858" y="-144.2">K</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02c70&#45;&gt;p0x7fecbdc031c0</title>
<path d="M742.19,-148C764.35,-148 796.33,-148 820.92,-148"/>
<polygon points="820.95,-151.5 830.95,-148 820.95,-144.5 820.95,-151.5"/>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02e90</title>
<ellipse cx="395" cy="-81" rx="27" ry="18.27"/>
<text text-anchor="middle" x="395" y="-77.2">G</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03600&#45;&gt;p0x7fecbdc02e90</title>
<path stroke-dasharray="5,2" d="M317.31,-78.82C331.13,-79.22 345.27,-79.62 357.58,-79.97"/>
<polygon points="357.78,-83.47 367.88,-80.26 357.98,-76.48 357.78,-83.47"/>
<text text-anchor="middle" x="345" y="-84.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc02fa0</title>
<ellipse cx="395" cy="-26" rx="27" ry="18.27"/>
<text text-anchor="middle" x="395" y="-22.2">H</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03600&#45;&gt;p0x7fecbdc02fa0</title>
<path stroke-dasharray="5,2" d="M288.22,-64.26C310.57,-56.18 339.3,-45.79 361.17,-37.87"/>
<polygon points="362.48,-41.12 370.69,-34.43 360.1,-34.54 362.48,-41.12"/>
<text text-anchor="middle" x="345" y="-51.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc030b0</title>
<ellipse cx="529" cy="-26" rx="27" ry="18.27"/>
<text text-anchor="middle" x="529" y="-22.2">I</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc02fa0&#45;&gt;p0x7fecbdc030b0</title>
<path d="M422.08,-26C442.06,-26 469.85,-26 491.95,-26"/>
<polygon points="491.98,-29.5 501.98,-26 491.98,-22.5 491.98,-29.5"/>
</g>
<g class="m-node">
<title>p0x7fecbdc03710</title>
<polygon points="715,-52 645,-26 715,0 785,-26 715,-52"/>
<text text-anchor="middle" x="715" y="-22.2">cond_3</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc030b0&#45;&gt;p0x7fecbdc03710</title>
<path d="M556.36,-26C576.9,-26 606.53,-26 634.57,-26"/>
<polygon points="634.81,-29.5 644.81,-26 634.81,-22.5 634.81,-29.5"/>
</g>
<g class="m-edge">
<title>p0x7fecbdc03710&#45;&gt;p0x7fecbdc03710</title>
<path stroke-dasharray="5,2" d="M698.83,-46.37C695.23,-58.54 700.62,-70 715,-70 725.22,-70 730.9,-64.21 732.04,-56.49"/>
<polygon points="735.51,-56.03 731.17,-46.37 728.54,-56.63 735.51,-56.03"/>
<text text-anchor="middle" x="715" y="-75.2">0</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc032d0</title>
<ellipse cx="858" cy="-26" rx="27" ry="18.27"/>
<text text-anchor="middle" x="858" y="-22.2">L</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc03710&#45;&gt;p0x7fecbdc032d0</title>
<path stroke-dasharray="5,2" d="M785.26,-26C797.48,-26 809.76,-26 820.61,-26"/>
<polygon points="820.93,-29.5 830.93,-26 820.93,-22.5 820.93,-29.5"/>
<text text-anchor="middle" x="808" y="-31.2">1</text>
</g>
<g class="m-node m-flat">
<title>p0x7fecbdc033e0</title>
<ellipse cx="949" cy="-26" rx="27" ry="18.27"/>
<text text-anchor="middle" x="949" y="-22.2">M</text>
</g>
<g class="m-edge">
<title>p0x7fecbdc032d0&#45;&gt;p0x7fecbdc033e0</title>
<path d="M885.22,-26C893.55,-26 902.91,-26 911.82,-26"/>
<polygon points="911.97,-29.5 921.97,-26 911.97,-22.5 911.97,-29.5"/>
</g>
</g>
</svg>
</div><p>You can use condition tasks to create cycles as long as the graph does not introduce task race during execution. However, cycles are not allowed in non-condition tasks.</p></section><section id="C4_TaskSchedulingPolicy"><h2><a href="#C4_TaskSchedulingPolicy">Understand our Task-level Scheduling</a></h2><p>In order to understand how an executor schedules condition tasks, we define two dependency types, <em>strong dependency</em> and <em>weak dependency</em>. A strong dependency is a preceding link from a non-condition task to another task. A weak dependency is a preceding link from a condition task to another task. The number of dependents of a task is the sum of strong dependency and weak dependency. The table below lists the strong dependency and weak dependency numbers of each task in the previous example.</p><table class="m-table"><thead><tr><th>task</th><th>strong dependency</th><th>weak dependency</th><th>dependents</th></tr></thead><tbody><tr><td>A</td><td>0</td><td>0</td><td>0</td></tr><tr><td>B</td><td>1</td><td>1</td><td>2</td></tr><tr><td>C</td><td>1</td><td>0</td><td>1</td></tr><tr><td>D</td><td>1</td><td>0</td><td>1</td></tr><tr><td>E</td><td>0</td><td>1</td><td>1</td></tr><tr><td>F</td><td>1</td><td>0</td><td>1</td></tr><tr><td>G</td><td>0</td><td>1</td><td>1</td></tr><tr><td>H</td><td>0</td><td>1</td><td>1</td></tr><tr><td>I</td><td>1</td><td>0</td><td>1</td></tr><tr><td>K</td><td>1</td><td>0</td><td>1</td></tr><tr><td>L</td><td>0</td><td>1</td><td>1</td></tr><tr><td>M</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_1</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_2</td><td>1</td><td>0</td><td>1</td></tr><tr><td>cond_3</td><td>1</td><td>1</td><td>2</td></tr></tbody></table><p>You can query the number of strong dependents, the number of weak dependents, and the number of dependents of a task.</p><pre class="m-code"><span class="mi">1</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Taskflow</span> <span class="n">taskflow</span><span class="p">;</span>
<span class="mi">2</span><span class="o">:</span> 
<span class="mi">3</span><span class="o">:</span> <span class="n">tf</span><span class="o">::</span><span class="n">Task</span> <span class="n">task</span> <span class="o">=</span> <span class="n">taskflow</span><span class="p">.</span><span class="n">emplace</span><span class="p">([](){});</span>
<span class="mi">4</span><span class="o">:</span> 
<span class="mi">5</span><span class="o">:</span> <span class="c1">// ... add more tasks and preceding links</span>
<span class="mi">6</span><span class="o">:</span>
<span class="mi">7</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">task</span><span class="p">.</span><span class="n">num_dependents</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<span class="mi">8</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">task</span><span class="p">.</span><span class="n">num_strong_dependents</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> 
<span class="mi">9</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">task</span><span class="p">.</span><span class="n">num_weak_dependents</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span></pre><p>When you submit a task to an executor, the scheduler starts with tasks of <em>zero dependents</em> (both zero strong and weak dependencies) and continues to execute successive tasks whenever their <em>strong dependencies</em> are met. However, the scheduler skips this rule when executing a condition task and jumps directly to its successors indexed by the return value.</p><div class="m-graph"><svg style="width: 65.375rem; height: 23.250rem;" viewBox="0.00 0.00 1045.82 372.08">
<g transform="scale(1 1) rotate(0) translate(4 368.08)">
<title>G</title>
<g class="m-node m-flat">
<title>atask</title>
<ellipse cx="642.34" cy="-345.69" rx="52.15" ry="18.27"/>
<text text-anchor="middle" x="642.34" y="-341.89">a task T</text>
</g>
<g class="m-node">
<title>cond</title>
<polygon points="642.34,-290.31 472.34,-264.31 642.34,-238.31 812.34,-264.31 642.34,-290.31"/>
<text text-anchor="middle" x="642.34" y="-260.51">is T a condition task?</text>
</g>
<g class="m-edge">
<title>atask&#45;&gt;cond</title>
<path d="M642.34,-327.08C642.34,-319.24 642.34,-309.73 642.34,-300.54"/>
<polygon points="645.84,-300.41 642.34,-290.41 638.84,-300.41 645.84,-300.41"/>
</g>
<g class="m-node m-flat">
<title>invokeN</title>
<ellipse cx="564.34" cy="-165.92" rx="59.29" ry="18.27"/>
<text text-anchor="middle" x="564.34" y="-162.12">invoke(T)</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;invokeN</title>
<path stroke-dasharray="5,2" d="M624.25,-240.95C612.4,-226.31 596.9,-207.16 584.63,-192"/>
<polygon points="587.21,-189.62 578.2,-184.04 581.77,-194.02 587.21,-189.62"/>
<text text-anchor="middle" x="615.84" y="-207.51">no</text>
</g>
<g class="m-node m-flat">
<title>invokeY</title>
<ellipse cx="814.34" cy="-165.92" rx="79.81" ry="18.27"/>
<text text-anchor="middle" x="814.34" y="-162.12">R = invoke(T)</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;invokeY</title>
<path stroke-dasharray="5,2" d="M677.56,-243.57C706.42,-227.4 747.16,-204.57 776.67,-188.03"/>
<polygon points="778.43,-191.06 785.44,-183.12 775,-184.95 778.43,-191.06"/>
<text text-anchor="middle" x="762.34" y="-207.51">yes</text>
</g>
<g class="m-node m-flat">
<title>decrement</title>
<ellipse cx="332.34" cy="-92.15" rx="332.18" ry="18.27"/>
<text text-anchor="middle" x="332.34" y="-88.35">decrement strong dependencies of each successor of T by one</text>
</g>
<g class="m-edge">
<title>invokeN&#45;&gt;decrement</title>
<path d="M523.93,-152.42C489.07,-141.64 438.09,-125.87 397.48,-113.31"/>
<polygon points="398.52,-109.96 387.93,-110.35 396.45,-116.65 398.52,-109.96"/>
</g>
<g class="m-node m-flat">
<title>enqueueR</title>
<ellipse cx="860.34" cy="-92.15" rx="177.47" ry="18.27"/>
<text text-anchor="middle" x="860.34" y="-88.35">enqueue the R&#45;th successor of T</text>
</g>
<g class="m-edge">
<title>invokeY&#45;&gt;enqueueR</title>
<path d="M825.48,-147.55C830.92,-139.06 837.58,-128.67 843.61,-119.25"/>
<polygon points="846.7,-120.92 849.15,-110.62 840.81,-117.15 846.7,-120.92"/>
</g>
<g class="m-node m-flat">
<title>enqueueS</title>
<ellipse cx="332.34" cy="-18.38" rx="258.6" ry="18.27"/>
<text text-anchor="middle" x="332.34" y="-14.58">enqueue successors of zero strong dpendencies</text>
</g>
<g class="m-edge">
<title>decrement&#45;&gt;enqueueS</title>
<path d="M332.34,-73.41C332.34,-65.5 332.34,-56 332.34,-47.18"/>
<polygon points="335.84,-46.92 332.34,-36.92 328.84,-46.92 335.84,-46.92"/>
</g>
</g>
</svg>
</div><p>Each task has an <em>atomic</em> join counter to keep track of strong dependents that are met at runtime. When a task completes, the join counter is restored to the task&#x27;s strong dependency number in the graph, such that the subsequent execution can reuse the counter again.</p><section id="TaskLevelSchedulingExample"><h3><a href="#TaskLevelSchedulingExample">Example</a></h3><p>Let&#x27;s take a look at an example to understand how task-level scheduling works. Suppose we have the following taskflow of one condition task <code>cond</code> that forms a loop to itself on returning <code>0</code> and moves on to <code>stop</code> on returning <code>1</code>:</p><div class="m-graph"><svg style="width: 19.688rem; height: 6.000rem;" viewBox="0.00 0.00 315.47 96.00">
<g transform="scale(1 1) rotate(0) translate(4 92)">
<title>Taskflow</title>
<g class="m-node">
<title>cond</title>
<polygon points="143,-52 91,-26 143,0 195,-26 143,-52"/>
<text text-anchor="middle" x="143" y="-22.2">cond</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;cond</title>
<path stroke-dasharray="5,2" d="M130.8,-45.91C127.86,-58.25 131.93,-70 143,-70 150.96,-70 155.3,-63.93 156.02,-55.94"/>
<polygon points="159.5,-55.59 155.2,-45.91 152.52,-56.16 159.5,-55.59"/>
<text text-anchor="middle" x="143" y="-75.2">0</text>
</g>
<g class="m-node m-flat">
<title>stop</title>
<ellipse cx="274.23" cy="-26" rx="33.47" ry="18.27"/>
<text text-anchor="middle" x="274.23" y="-22.2">stop</text>
</g>
<g class="m-edge">
<title>cond&#45;&gt;stop</title>
<path stroke-dasharray="5,2" d="M195.08,-26C206.85,-26 219.26,-26 230.63,-26"/>
<polygon points="230.73,-29.5 240.73,-26 230.73,-22.5 230.73,-29.5"/>
<text text-anchor="middle" x="218" y="-31.2">1</text>
</g>
<g class="m-node m-flat">
<title>init</title>
<ellipse cx="27" cy="-26" rx="27" ry="18.27"/>
<text text-anchor="middle" x="27" y="-22.2">init</text>
</g>
<g class="m-edge">
<title>init&#45;&gt;cond</title>
<path d="M54.15,-26C62.17,-26 71.35,-26 80.68,-26"/>
<polygon points="80.82,-29.5 90.82,-26 80.82,-22.5 80.82,-29.5"/>
</g>
</g>
</svg>
</div><p>The scheduler starts with <code>init</code> task because it has no dependencies (both strong and weak dependencies). Then, the scheduler moves on to the condition task <code>cond</code>. If <code>cond</code> returns <code>0</code>, the scheduler enqueues <code>cond</code> and runs it again. If <code>cond</code> returns <code>1</code>, the scheduler enqueues <code>stop</code> and then moves on.</p></section></section><section id="C4_AvoidCommonPitfalls"><h2><a href="#C4_AvoidCommonPitfalls">Avoid Common Pitfalls</a></h2><p>Condition tasks are handy in creasing dynamic and cyclic control flows, but they are also easy to make mistakes. It is your responsibility to ensure a taskflow is properly conditioned. Top things to avoid include <em>no source tasks</em> to start with and <em>task race</em>. The figure below shows common pitfalls and their remedies.</p><div class="m-graph"><svg style="width: 62.062rem; height: 19.688rem;" viewBox="0.00 0.00 993.00 314.77">
<g transform="scale(1 1) rotate(0) translate(4 310.77)">
<title>Taskflow</title>
<g class="m-cluster">
<title>cluster_error1</title>
<polygon points="8,-106.38 8,-298.77 190,-298.77 190,-106.38 8,-106.38"/>
<text text-anchor="middle" x="99" y="-281.97">error1: no source tasks</text>
</g>
<g class="m-cluster">
<title>cluster_fix1</title>
<polygon points="198,-8 198,-291.15 351,-291.15 351,-8 198,-8"/>
<text text-anchor="middle" x="274.5" y="-274.35">fix1: adds a source</text>
</g>
<g class="m-cluster">
<title>cluster_error2</title>
<polygon points="359,-106.38 359,-298.77 503,-298.77 503,-106.38 359,-106.38"/>
<text text-anchor="middle" x="431" y="-281.97">error2: race on D</text>
</g>
<g class="m-cluster">
<title>cluster_fix2</title>
<polygon points="511,-8 511,-298.77 755,-298.77 755,-8 511,-8"/>
<text text-anchor="middle" x="633" y="-281.97">fix2: adds an auxiliary task</text>
</g>
<g class="m-cluster">
<title>cluster_risky</title>
<polygon points="763,-106.38 763,-298.77 977,-298.77 977,-106.38 763,-106.38"/>
<text text-anchor="middle" x="870" y="-281.97">risky: X might be raced</text>
</g>
<g class="m-node">
<title>e1A</title>
<polygon points="59,-264.77 32,-238.77 59,-212.77 86,-238.77 59,-264.77"/>
<text text-anchor="middle" x="59" y="-234.97">A</text>
</g>
<g class="m-edge">
<title>e1A&#45;&gt;e1A</title>
<path stroke-dasharray="5,2" d="M77.49,-247.47C90.77,-250.3 104,-247.4 104,-238.77 104,-232.36 96.71,-229.11 87.53,-229.02"/>
<polygon points="87.07,-225.55 77.49,-230.07 87.8,-232.51 87.07,-225.55"/>
<text text-anchor="middle" x="109" y="-234.97">0</text>
</g>
<g class="m-node m-flat">
<title>e1B</title>
<ellipse cx="51" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="51" y="-128.97">B</text>
</g>
<g class="m-edge">
<title>e1A&#45;&gt;e1B</title>
<path stroke-dasharray="5,2" d="M57.2,-214.43C56,-198.71 54.4,-177.91 53.12,-161.36"/>
<polygon points="56.6,-160.91 52.34,-151.21 49.62,-161.45 56.6,-160.91"/>
<text text-anchor="middle" x="60" y="-181.97">1</text>
</g>
<g class="m-node m-flat">
<title>e1C</title>
<ellipse cx="123" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="123" y="-128.97">C</text>
</g>
<g class="m-edge">
<title>e1A&#45;&gt;e1C</title>
<path stroke-dasharray="5,2" d="M68.72,-221.97C79.04,-205.2 95.51,-178.44 107.6,-158.79"/>
<polygon points="110.72,-160.41 112.98,-150.06 104.76,-156.74 110.72,-160.41"/>
<text text-anchor="middle" x="99" y="-181.97">2</text>
</g>
<g class="m-node m-flat">
<title>f1S</title>
<ellipse cx="249" cy="-238.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="249" y="-234.97">S</text>
</g>
<g class="m-node">
<title>f1A</title>
<polygon points="249,-158.77 222,-132.77 249,-106.77 276,-132.77 249,-158.77"/>
<text text-anchor="middle" x="249" y="-128.97">A</text>
</g>
<g class="m-edge">
<title>f1S&#45;&gt;f1A</title>
<path d="M249,-220.13C249,-206.21 249,-186.35 249,-169.18"/>
<polygon points="252.5,-168.92 249,-158.92 245.5,-168.92 252.5,-168.92"/>
</g>
<g class="m-edge">
<title>f1A&#45;&gt;f1A</title>
<path stroke-dasharray="5,2" d="M267.49,-141.47C280.77,-144.3 294,-141.4 294,-132.77 294,-126.36 286.71,-123.11 277.53,-123.02"/>
<polygon points="277.07,-119.55 267.49,-124.07 277.8,-126.51 277.07,-119.55"/>
<text text-anchor="middle" x="299" y="-128.97">0</text>
</g>
<g class="m-node m-flat">
<title>f1B</title>
<ellipse cx="238" cy="-34.38" rx="27" ry="18.27"/>
<text text-anchor="middle" x="238" y="-30.58">B</text>
</g>
<g class="m-edge">
<title>f1A&#45;&gt;f1B</title>
<path stroke-dasharray="5,2" d="M246.39,-108.93C244.82,-95.13 242.8,-77.46 241.14,-62.9"/>
<polygon points="244.61,-62.48 240,-52.94 237.66,-63.27 244.61,-62.48"/>
<text text-anchor="middle" x="248" y="-75.97">1</text>
</g>
<g class="m-node m-flat">
<title>f1C</title>
<ellipse cx="310" cy="-34.38" rx="27" ry="18.27"/>
<text text-anchor="middle" x="310" y="-30.58">C</text>
</g>
<g class="m-edge">
<title>f1A&#45;&gt;f1C</title>
<path stroke-dasharray="5,2" d="M259.07,-115.85C268.64,-100.74 283.17,-77.78 294.26,-60.25"/>
<polygon points="297.32,-61.97 299.71,-51.65 291.4,-58.22 297.32,-61.97"/>
<text text-anchor="middle" x="291" y="-75.97">2</text>
</g>
<g class="m-node">
<title>e2C</title>
<polygon points="467,-264.77 439,-238.77 467,-212.77 495,-238.77 467,-264.77"/>
<text text-anchor="middle" x="467" y="-234.97">C</text>
</g>
<g class="m-node m-flat">
<title>e2D</title>
<ellipse cx="395" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="395" y="-128.97">D</text>
</g>
<g class="m-edge">
<title>e2C&#45;&gt;e2D</title>
<path stroke-dasharray="5,2" d="M456.38,-222.42C444.65,-205.49 425.63,-178.01 411.87,-158.13"/>
<polygon points="414.71,-156.09 406.14,-149.86 408.96,-160.08 414.71,-156.09"/>
<text text-anchor="middle" x="440" y="-181.97">0</text>
</g>
<g class="m-node m-flat">
<title>e2F</title>
<ellipse cx="467" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="467" y="-128.97">F</text>
</g>
<g class="m-edge">
<title>e2C&#45;&gt;e2F</title>
<path stroke-dasharray="5,2" d="M467,-212.59C467,-197.16 467,-177.38 467,-161.5"/>
<polygon points="470.5,-161.23 467,-151.23 463.5,-161.23 470.5,-161.23"/>
<text text-anchor="middle" x="472" y="-181.97">1</text>
</g>
<g class="m-node m-flat">
<title>e2E</title>
<ellipse cx="394" cy="-238.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="394" y="-234.97">E</text>
</g>
<g class="m-edge">
<title>e2E&#45;&gt;e2D</title>
<path d="M394.17,-220.13C394.32,-204.14 394.55,-180.31 394.73,-161.73"/>
<polygon points="398.23,-161.53 394.83,-151.5 391.23,-161.46 398.23,-161.53"/>
</g>
<g class="m-node">
<title>f2C</title>
<polygon points="662,-264.77 634,-238.77 662,-212.77 690,-238.77 662,-264.77"/>
<text text-anchor="middle" x="662" y="-234.97">C</text>
</g>
<g class="m-node m-flat">
<title>f2Daux</title>
<ellipse cx="633" cy="-132.77" rx="41.94" ry="18.27"/>
<text text-anchor="middle" x="633" y="-128.97">D&#45;aux</text>
</g>
<g class="m-edge">
<title>f2C&#45;&gt;f2Daux</title>
<path stroke-dasharray="5,2" d="M656.41,-217.72C651.92,-201.63 645.58,-178.89 640.63,-161.13"/>
<polygon points="643.96,-160.03 637.9,-151.34 637.21,-161.91 643.96,-160.03"/>
<text text-anchor="middle" x="654" y="-181.97">0</text>
</g>
<g class="m-node m-flat">
<title>f2F</title>
<ellipse cx="720" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="720" y="-128.97">F</text>
</g>
<g class="m-edge">
<title>f2C&#45;&gt;f2F</title>
<path stroke-dasharray="5,2" d="M671.32,-221.06C680.68,-204.28 695.21,-178.23 705.96,-158.95"/>
<polygon points="709.08,-160.53 710.9,-150.09 702.97,-157.12 709.08,-160.53"/>
<text text-anchor="middle" x="699" y="-181.97">1</text>
</g>
<g class="m-node m-flat">
<title>f2D</title>
<ellipse cx="590" cy="-34.38" rx="27" ry="18.27"/>
<text text-anchor="middle" x="590" y="-30.58">D</text>
</g>
<g class="m-edge">
<title>f2Daux&#45;&gt;f2D</title>
<path d="M625.31,-114.54C618.73,-99.78 609.15,-78.31 601.63,-61.45"/>
<polygon points="604.75,-59.85 597.48,-52.14 598.35,-62.7 604.75,-59.85"/>
</g>
<g class="m-node m-flat">
<title>f2E</title>
<ellipse cx="546" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="546" y="-128.97">E</text>
</g>
<g class="m-edge">
<title>f2E&#45;&gt;f2D</title>
<path d="M553.66,-114.98C560.37,-100.28 570.23,-78.68 577.99,-61.69"/>
<polygon points="581.31,-62.86 582.28,-52.3 574.94,-59.95 581.31,-62.86"/>
</g>
<g class="m-node">
<title>rP</title>
<polygon points="896,-264.77 869,-238.77 896,-212.77 923,-238.77 896,-264.77"/>
<text text-anchor="middle" x="896" y="-234.97">P</text>
</g>
<g class="m-node m-flat">
<title>rQ</title>
<ellipse cx="942" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="942" y="-128.97">Q</text>
</g>
<g class="m-edge">
<title>rP&#45;&gt;rQ</title>
<path stroke-dasharray="5,2" d="M903.8,-220.13C911.14,-203.55 922.2,-178.53 930.54,-159.68"/>
<polygon points="933.77,-161.03 934.62,-150.46 927.37,-158.19 933.77,-161.03"/>
<text text-anchor="middle" x="926" y="-181.97">0</text>
</g>
<g class="m-node m-flat">
<title>rX</title>
<ellipse cx="870" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="870" y="-128.97">X</text>
</g>
<g class="m-edge">
<title>rP&#45;&gt;rX</title>
<path stroke-dasharray="5,2" d="M890.86,-217.22C886.83,-201.09 881.18,-178.49 876.78,-160.88"/>
<polygon points="880.17,-160.02 874.35,-151.17 873.38,-161.72 880.17,-160.02"/>
<text text-anchor="middle" x="889" y="-181.97">1</text>
</g>
<g class="m-node">
<title>rM</title>
<polygon points="814,-264.77 784,-238.77 814,-212.77 844,-238.77 814,-264.77"/>
<text text-anchor="middle" x="814" y="-234.97">M</text>
</g>
<g class="m-edge">
<title>rM&#45;&gt;rX</title>
<path stroke-dasharray="5,2" d="M823.25,-220.6C832.23,-203.91 845.98,-178.38 856.24,-159.32"/>
<polygon points="859.45,-160.75 861.11,-150.28 853.29,-157.43 859.45,-160.75"/>
<text text-anchor="middle" x="850" y="-181.97">0</text>
</g>
<g class="m-node m-flat">
<title>rN</title>
<ellipse cx="798" cy="-132.77" rx="27" ry="18.27"/>
<text text-anchor="middle" x="798" y="-128.97">N</text>
</g>
<g class="m-edge">
<title>rM&#45;&gt;rN</title>
<path stroke-dasharray="5,2" d="M810.57,-215.46C808.14,-199.69 804.87,-178.45 802.28,-161.58"/>
<polygon points="805.67,-160.58 800.69,-151.23 798.75,-161.64 805.67,-160.58"/>
<text text-anchor="middle" x="811" y="-181.97">1</text>
</g>
</g>
</svg>
</div><p>In the <code>error1</code> scenario, there is no source task for the scheduler to start with, and the simplest fix is to add a task <code>S</code> that has no dependents. In the <code>error2</code> scenario, <code>D</code> might be scheduled twice by <code>E</code> through the strong dependency and <code>C</code> through the weak dependency (on returning <code>1</code>). To fix this problem, you can add an auxiliary task <code>D-aux</code> to break the mixed use of strong dependency and weak dependency. In the risky scenario, task <code>X</code> may be raced by <code>M</code> and <code>P</code> if <code>M</code> returns <code>0</code> and P returns <code>1</code>.</p><aside class="m-note m-warning"><h4>Attention</h4><p>It is your responsibility to ensure a written taskflow graph is properly conditioned. We suggest that you <a href="chapter4.html#C4_TaskSchedulingPolicy" class="m-doc">Understand our Task-level Scheduling</a> and infer if task race exists in the execution of your graph.</p></aside></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Taskflow handbook is part of the <a href="https://taskflow.github.io">Taskflow project</a>, copyright © <a href="https://tsung-wei-huang.github.io/">Dr. Tsung-Wei Huang</a>, 2018&ndash;2021.<br />Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.20 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
